2016/9/5








vxの前に

コンピュ`タグラフィックス
第１回vxY料

? 受v生の到_目
? コンピュ`タグラフィックスの技g体系を理解するとともに，座Q， モデリング，レンダリングなどの基本的な知Rを理解する．

? 事前に履修しておくことが望まれる科目
立命^大学
情罄砉ぱР   メディア情笱Э 李  亮  
2016. 9. 5
? 数学の基本的な知Rが必要なので，「情蠡A数学」と「メディア基A数 学」を先に履修しておくこと．

? 教科
? コンピュ`タグラフィックス，CG-ARTSf会











成u方法


Ne                   割合                            u基胜胜


期末Y               50%         授I中にvx内容の理解度を_Jするため のPYを行う

CGアニメ`ション作成のn}を出し，
コンピュ`タグラフィックスとは

? Computer Graphics (CG)

? コンピュ`タによる硇I理技g
? コンピュ`タ内に硇韦浠像を作成し，コンピュ` タでI理し，それらをディスプレイやプリンタ等のグ ラフィックス出力装置によって表示する技g
レポ`ト                25%
そのレポ`トの内容によりu
（は第三回の授Iにh明する）

平常点                 25%                       出席状r?学B度など










CG or Photo?
CG or Photo?


CG                                                                                                  
                                                  Photo

















1
2016/9/5








CG or Photo?


CG                                                                   Photo
CGの社会での暧

? 出版（静止画）?アニメ`ション（踊）など
? 基本的には，市のソフトウェアを 使用して制作
? プログラミングは不要（まれに必要）
? 原理は理解しておく必要がある
? デザイン能力などが必要
? コンピュ`タゲ`ムなど
? プログラミングが不可欠
? gHにゲ`ムを制作するためには， 多数のデ`タも必要になる
Toy Story 2 ? 1999 Disney?Pixar


DEAD OR ALIVE 3 ? 2002 TECMO, LTD.








CGはどのような役に立つか

? CGは映画?出版?ゲ`ムなどに幅冥使われている
? 基A的な技gや考え方は，常Rとして押さえておくべき
? ツ`ルとしてCG技gを利用することは多い
? ロボットのシミュレ`ションY果の表示
? 各N解析Y果の表示
? Virtual Reality  インタ`フェ`ス
? CT, PET, MRI画像
? カ`ナビなど
CGの概要（1）

? CG画像を生成するためのしくみ
? ⑾肟臻gにオブジェクトを配置
? ⑾氲膜圣メラからえる映像を算で生成
? オブジェクトやカメラを婴すことでアニメ`ション

オブジェクト 生成画像


光源 カメラ








CGの概要（2）
CGと画像I理

? コンピュ`タグラフィックスの主な技g

いかに自然な画像を高速に算するか

オブジェクトの作成方法 オブジェクトの形状表F

出力
硇?画像                         述 入力

狭xの画像I理

生成画像
オブジェクト


表面の素材の表F
硇?画像

述
（画像改善?画像Q）      画像解析またはJR
（数?号デ`タ）                    CG                          他の情I理

婴のデ`タの生成
光源

? 画像I理：画像デ`タから数?号
画像I理
カメラ カメラからえる画像を算
光の抗の表F
? CG：数?号から画像生成              互いに反







2
2016/9/5








コンピュ`タグラフィックスのs史（1）

? CG研究の始まり（1960年代～）
? I. E. SutherlandがSketchpadを_k（1963）
? 世界初の型硇I理システム
コンピュ`タグラフィックスのs史（2）

? CG技gのg用化（1970年代～）
? g用的なbI暧盲丐位钣盲始まった
? ユタ大学CGグル`プの活S
? L面消去，シェ`ディング，ライティング，マッピングなど各N アルゴリズムの研究
? ニュ`ヨ`ク工科大学の研究
? アニメ`ション














コンピュ`タグラフィックスのs史（3）

? CGがTVや映画で利用され始める（1980年代～）
? 最初は，TV番Mのタイトルやアイキャッチの文字などの短 いカットにCGが使われる
? 映画への暧
? Tron (1982) Terminator 2 (1991） Jurassic Park (1993)
Titanic (1997)など
? g写＋CGの合成
コンピュ`タグラフィックスのs史（4）

? g写＋CGの合成
? g写ではgFできないような映像のみをCGで表F
? 我々の身近にある物，特に人gなどはCGで再Fすること がyしい
? 少しでも不自然なところがあるとすぐ目立つ
? あまり身近にないような物，g写では~に撮影できないよ うな物をCGで作り出す
? g写で撮影可能なものにはCGは使わず，g写とCGを合成

Jurassic Park ?1993 Universal City Studios, Inc. and Amblin Entertainment, Inc.








コンピュ`タグラフィックスのs史（5）

? フルCG映画のu作（1990年代後半～）
? 全ての映像をCGだけでu作するみ
? Toy Story (1995), Shrek (2001), Monsters Inc.(2002) Final Fantasy, The Movie (2001)など








Toy Story ? 1995 Disney?Pixar           Final Fantasy ? 2001 SQUARE
コンピュ`タグラフィックスの暧

? 映画?放送?ゲ`ム
? O?u造分野（CAD）
? シミュレ`ション
? 医
? バ`チャルリアリティ
? 可化
? CGア`ト
? ユ`ザインタ`フェ`ス







3
2016/9/5








コンピュ`タアニメ`ション
リアルタイム?アニメ`ションの暧

? オフライン?アニメ`ション
? 映画やTVなど
? あらかじめ登鋈宋铯婴 がQまっている
? リアルタイム?アニメ`ション
? コンピュ`タゲ`ムなど
? ユ`ザの操作に辘袱 ダイナミックに婴を浠 させる必要がある
? 自然な婴を生成するの
は非常にyしい                            Virtual Fighter, 1993, ? SEGA

? コンピュ`タゲ`ム
? ⑾毳攻骏弗
? ⑾氲膜圣互氓趣沃肖谴橛
? ⑾氲膜圣ャラクタとg写 のキャラクタを合成
? マルチユ`ザ⑾氍Fgh境
? ゲ`ム（Final Fantasy等）
? コミュニケ`ション
? 教育，トレ`ニング






ウゴウゴル`ガ ? 1993 フジＴＶ






Final Fantasy Online ? 2002 SQUARE








CAD

? CAD (Computer Aided Design)
? コンピュ`タによるO支援
CADの利点（1）

? デザイン作Iがg
? 自由にコピ`，やり直しなどができる
? デザインY果がCGで_Jできる
? クライアントにアピ`ルしやすい
? CGであれば非T家にも分かりやすい
? デ`タの管理?取りQいがしやすい
? CAM (Computer Aided Manufacturing)
? コンピュ`タによるu造支援
? F在，自榆I界などのu造Iではデ`タのデジタル化が 急速にMめられつつある











CADの利点（2）

? いろんなデザインをgに比^できる
CADの利点（3）

? デザインしたu品の性能?使いやすさなどを算C 上でuできる
? CAE (Computer Aided Engineering)
? コンピュ`タによる技g的?工学的なOの支援
? 造解析，空力?破播伐撺濂飑`ションなど






日UＣＧ 2000年7月号 p143
日UＣＧ 1999年10月号 p142







4
2016/9/5








シミュレ`ション

? シミュレ`ションはコンピュ`タグラフィックスと非常に 近い技g
? Fgの物体になるべく近いモデルを算C上にBすると いう点で共通
? シミュレ`ションでは，婴のモデルや，恿ρУ那螅ㄙ| 量?T性テンソル，摩擦S数）も必要
? シミュレ`ションのY果を利用者に表示するためにも通常
CGが使われる
各Nシミュレ`ション技g

? ，w行Cなどの性能予y
? 衣服デザイン



ヨットの空力解析 日UＣＧ 2000年3月号 p117
衣服シミュレ`ション
digital fashion, inc.








バ`チャル?ヒュ`マン

? ⑾氲膜嗜碎gを算C上に作り出す技g
? 骨格，筋肉，内などもできるだけ 正_にモデル化
? 医学などにも活用
? インフォ`ムド?コンセント
? アニメ`ションに暧盲工欷校
可化

? 人gの目にえない情螭颍CGを使って硇韦摔工 ことによって，人gが理解しやすくするための技g
? 可化の技gは大きく2Nに分けられる
? 科学技g算の可化（Scientific Visualization）
? 3次元空gのg体にvBした情螭蚩梢化
? 情罂梢化（Information Visualization）
よりリアルな皮wの湫韦胜嗓
シミュレ`トできる
? 手gシミュレ`タ



日UＣＧ 200年3月号 p120
Visible Human Project




筋骨シミュレ`ション SIMM
? 比^的最近になって研究されている技g
? 3次元空gとはあまりvSのない抽象的情螭蚩梢化








科学技g算Y果の可化

? シミュレ`ションY果などを可化
? 流れ，界，菹笄螭胜
情罂梢化

? 大量の情螭颏いに 分かりやすくせるか
? ツリ`造，グラフなどを利用


Parallel Coordinates[Inselberg91]



エンジン_kのための三次元流体シミュレ`ションの Y果[NASUDA NEWS No.261]



医C器中の血液の流れ 日UＣＧ 2000年9月号 p177

Spotfire
XGobi[Becker96]



INFOVISOR［NTT99］       ConeTree [Robertson91]







5
2016/9/5








ユ`ザ`インタ`フェ`ス

? グラフィックスを用いることでユ`ザとコンピュ`タの gの情蠼Qを助ける
? 算Cの情螭蚍证りやすくユ`ザに护à
? ユ`ザの意恧颏胜毪伽gな操作でコンピュ`タに护à
? 最近は，た目の美しさにも力が注がれつつある
2次元のグラフィックス

? コンピュ`タの画面は，ピクセルの集まりによってできている




ユ`ザ` インタ`フェ`ス










光の三原色

? 赤（Ｒ），v（Ｇ），青（Ｂ）の混ぜ合わせによってあらゆる色を表 Fすることができる
R, G, B = (0.0, 1.0, 0.0) 各色0.0～1.0のg数で表した龊
= (0, 255, 0) 各色１バイト(0～255)で表した龊

R, G, B = (1.0, 0.0, 1.0)
= (255, 0, 255)
光の三原色と色の三原色

? 光の三原色（赤，v，青；RGB）
? ?を混ぜる挨嗣鳏毪丹加して?に近づく（加法混色）
? カラ`テレビ，CRT，訾违攻荪氓去楗ぅ鹊
? 色の三原色（シアン，マゼンタ，イエロ`；CMY）
? ?を混ぜる挨嗣鳏毪丹p少して?に近づく（p法混色）
? 水彩画の具やカラ`印刷、?セロファンの重ね合わせ等

R, G, B = (1.0, 1.0, 1.0)
= (255, 255, 255)

R, G, B = (0.0, 0.0, 0.0)
= (0, 0, 0)









ベクトルの色々な定x


CGの基A数学

? 高校での定x
? 大きさと方向を持つ量をベクトルという
? 演算についての定xを付加したい

? 形代数でった定x
? 集合 V が加法の公理とスカラ`\法の公理を氦郡工趣，V の元を ベクトルという
? 演算にこだわりすぎ，数学的すぎて使いにくい

? プログラミングで使われることがある定x
? 数のセット，配列
? 数学的には`った定x








6
2016/9/5








ベクトルの定x

? 大きさと方向をもつ量で，かつ， その合成（加法）が平行四x形の法tに兢 ものを，ベクトルと呼ぶ．


a                       a + b
ベクトルの例

? 物理学におけるベクトルの例
? 速度，加速度，力，

? CGで使うベクトルの例
? 位置ベクトル
? 曲の接ベクトル
? 平面や曲面の法ベクトル
? ベクトル，光の方向ベクトル


b









ベクトルとスカラ`

? ベクトル（vector）
? 「方向」を持つ量である ベクトルが座讼丹位剀にして座摔韧じように浠する ということである

? スカラ`（scalar）
? 定x： 大きさを持ち，座诵韦位剀にして不浃柿
? 例：|量，Lさ，エネルギ`
? Z源：「スケ`ル（scale）」
位置ベクトル

? 点 P の位置ベクトルは，原点 O（オ`）から，点 P へYぶ ベクトル OP で表Fする
? 位置ベクトルを考える龊悉希必ず原点 O が定xされている
? 位置ベクトル以外では不要
? 位置ベクトルは，特定の座讼丹入しなくても定xできる： 原点 O さえ与えれば良い

P                         位置ベクトルの~（Lさ）： 点 P から原点までの距x

?
O                                           ? ?   ?
原点                                            ?
?  ?    ?? ? ?? ? ??









ベクトルの内e

? 内e（inner product）の定x
a ? b ? a b cos?

? ベクトルの内eのY果はスカラ`である
? 互いに垂直なベクトルの内eはゼロ
ベクトルの外e

? 外e（outer product）の定x
? a ×b とき，Y果はベクトルである
? Lさ：a と b をO接する2xとする平行四x形の面e
a ? b = a b sin?

? 方向： a から b の方向に回したrに右ねじのMむ方向
a                                                                         a ? b            b

?                                                                                     ?
b                                                                     0                     a







7
2016/9/5








演n}（1/2）
演n}（1/2）        解答例

? ベクトル ? ? ?2, 3, 1? と ? ? ?0, 4, ?1? との内eを 算せよ．

? ヒント：

? 内e

a ? b ? x1 x2 ? y1 y2 ? z1 z2
? 2 ? 0 ? 3? 4 ?1? (?1)
? 0 ?12 ?1 ? 11
ベクトルの内eのY果はスカラ`であり，直接に各ベ クトル成分から算される．

a ? b ? x1x2 ? y1 y2 ? z1 z2
? 内eを通してベクトルgの角度が算できる

? ? arccos a ? b  a b  











行列

? m×n の行列：mnの数???  ? ?? ? 1,2, … , ?; ? ?
1,2, … , ?? をL方形状に配置したもの
行列の演算

? 行列の和，差：行列 A, B がともに m×n 行列のとき，

A ? B ? ??aij ? bij ??
? a11
a12
?    a1 j
?    a1n  ?
←（第1行）
?                                                 ?                                                 
          （秃磐）  辘工氤煞证搐趣魏停差をつくる
? a21
a22
?   a2 j
?    a2 n ?
←（第2行）
?  ?        ?               ?               ?  ?
A ? ?                                                 ?
? ai1
ai 2
?    aij
?    ain  ?
←（第i行）
? 行列のスカラ`倍：行列 A，スカラ` λ にし，
?  ?        ?               ?               ?  ?
?                                                 ?
? A ? ??? aij ??
?  m1       am 2
?   amj
?   amn ?
←（第m行）
?                                                 ?
↑           ↑                  ↑                 ↑
A のすべての成分を λ 倍する
（第1列）（第2列）
（第j列）
（第n列）









行列の演算
演n}（2/2）

? 行列のe： A の列の数と B の行の数が等しいとき，
n
A が m×n 行列， B が n×l 行列ならば，

? ?1    3 ?
A ? ? 1     5 ?
?            ?

のとき，次の行列の中で A+B が定x
AB ? ??cij ?? ,
cij  ? ? aik bkj
k ?1
AB は m×l 行列です
? 3    ?2 ?

? b11

?   b1 j
?   b1l  ?
されるものと， AB が定xされるものをxび、各々の
?                                    ?                                                              
合に算せよ．
B ? ? b21
? ?
?   b2 j
?
?   b2l ?
? ?

? 2    ?3 ?
?                                    ?                                                              
               ? 2    1 ?
?            ?                 ? 3    2
?4 ?

? a11

a12
? bn1      ?
?   a1n  ?  ? c11
bnj
?
?   bnl ?
c1l  ?
B1  ? ? ?3   4 ?
B2  ? ? ?4    1 ?
? 5     1 ?
B3  ? ? ?4   1    3 ?
?                               ?  ?                                   ?
?  ?       ?               ?  ?  ?                                   ?
? 1 ?
A ? ? ai1
ai 2
?    ain  ?  ? ?    ?
cij
? ? AB                                                                    ?    ?
? 2 ?
?                               ?  ?                                   ?
?  ?       ?               ?  ?  ?                                   ?
B4  ? ? 2 ?
? ?1?
B5  ? ? 4
?1   3?
B6  ? ?  ?
? 1 ?
?  m1      am 2
?   amn ?  ? cm1
cml ?                                                                              ?    ?
?                               ?  ?                                   ?







8
2016/9/5








演n}（2/2）          解答例

和が定xできるのは，A と同じ 3×2 行列だから、B2
だけです．
演n}（2/2）          解答例

e AB が定xできるのは，（Aの列の数）=（Bの行の 数） のときだから，B1， B3 ， B6です．

? ?1    3 ?                  ?  ?1? 2 ? 3 ? (?3)

?1?1 ? 3 ? 4 ?

? ?11   11 ?
? ?1    3 ?   ? 2
?3 ?
? 1     0 ?
AB ? ? 1     5 ? ? 2    1 ? ? ?  1? 2 ? 5 ? (?3)        1?1 ? 5 ? 4
? ? ? ?13   21 ?
?            ?   ?            ?   ?            ?
1       ?            ? ? ?
?   ?                                                     ?   ?              ?
A ? B2  ? ? 1     5 ? ? ? ?4    1 ? ? ? ?3    6 ?
? 3    ?2 ? ?  3   4 ?
? 3 ? 2 ? (?2) ? (?3)   3 ?1 ? (?2) ? 4 ?
? 12
?5 ?
? 3    ?2 ?   ? 5
1 ?   ? 8
?1?
?            ?                  ?
?   ?              ?
?            ?   ?
?   ?            ?

? ?1    3 ?
?            ? ? 3    2

?4 ?

? ?15   1    13 ?
?                      ?
AB3  ? ? 1     5 ? ? ?4   1
3 ? ? ? ?17   7    11 ?
? 3    ?2 ? ?                  ?
? 17     4
?18 ?
?            ?                          ?                      ?
? ?1    3 ?
? 1 ?   
AB6  ?
? 1      5  ? ? 2 ?    ?  ?   
?             ?  1      ?  ?   
? 3    ?2 ? ?  ?   ? 4 ?
?            ?          ?  ?




















































9
2016/9/5








今回のvx内容

コンピュ`タグラフィックス
第２回vxY料（2次元座Q）

立命^大学 情罄砉ぱР   メディア情笱Э
李  亮  
2016. 9. 5

? 缀Q
? 2次元座讼担2次元硇
? 2次元缀Q：平行移樱大?s小，回，R映，スキュ`

? 同次座摔群铣Q
? 同次座
? 合成Q

? ビュ`ポ`トQとクリッピング
? 世界座摔茸爸米
? ウインドウとビュ`ポ`ト
? クリッピング









2次元座讼

? 2次元直交座讼
? 位置はx, y各Sにする位置を表す数のM (x, y) で表F
? O座讼
? 位置は原点からの距x r と基胜畏较颏らの角度 θ とのM (r, θ) で 表F
2次元硇

? 代表的な2次元硇韦摔希分やポリゴン（polygon, 多角形） などがある．
? すでに定xされている硇韦して平行移樱大?s小，回 などの湫尾僮鳏缀窝УQ（geometric transformation）と呼ぶ．
y

P (a,b)
b

d



Q (c,d)
y

P (r, θ)

r

θ


直交座讼丹 O座讼丹伍vS
?a ? r cos?
?
?b ? r sin ?
y                                                                                           点の座 B  
                     G                                                ???? , ?? ? F                 
              ???? , ?? ?
???? , ?? ?
…

C                            E                        硇危ǖ悚瘟肖潜恧梗
A                                                                               分A-B
D                             ポリゴンC-D-E-F-G
O            a               c             x            O                            x
O                                                                               x








2次元缀Q：平行移

? 硇韦々の点 (x, y) を，x, y各S方向にそれぞれ tx, ty だけ 移婴丹唬移俞幛蔚悚 (x’, y’) とする． この操作を平行移樱translation）と呼ぶ．
2次元缀Q：大?s小

? 点 (x, y) の座 x と y をそれぞれ sx, sy 倍し，Y果点を (x’, y’) とする． この操作を（原点中心の）大?s小（scaling）と呼ぶ．

(x’, y’)
y                                     tx
ty
(x, y)
(x’, y’)


x ' ? x ? tx
y


(x, y)
x' ? sx x y' ? s y y
大
y ' ? y ? t y
s ＞1（あるいはs  ＞1 ）
x                                      y
s小
0＜sx＜1（あるいは0＜ sy ＜1 ）

O                                                                               x                   
                                                         O                                          
                                     x







1
2016/9/5








2次元缀Q：回

? 原点を中心に，点 (x, y) を反rまわりに角度 θ だけ回さ せ，Y果点を (x’, y’) とする． この操作を（原点中心の）回（rotation）と呼ぶ．
演n}（1/3）

? 原点を中心に，点 (x, y) を反rまわりに角度 θ だけ回させ， Y果点を (x’, y’) とする回操作の次式を^明せよ．

y

x' ? x cos? ? y sin ?
y' ? x sin ? ? y cos?

θ

O                                                                               x

y


(x’, y’)

r
θ
φ
O






(x, y)

x ' ? x cos? ? y sin ?
y ' ? x sin ? ? y cos?

ヒント：
cos(? ? ? ) ? cos? cos ? ? sin ? sin ?


x








演n}（1/3）        解答例

? 以下の4つの式より  φ を消去すると，前のスライドの式が得ら れる．

? x ' ? r cos(? ? ? ) ? r cos? cos ? ? r sin ? sin ?
大?s小，回の行列表F

? すべてのQがy一的な方法で述できることが望ましい
→ 通常座摔蛐辛肖去佶トルで表すことに
y          ? y ' ? r sin(? ? ? ) ? r sin ? cos ? ? r cos? sin ?
x' ? S x x
S
?   ? ? ?   x
0 ??   ?
?                                                                                              
大?s小
y' ? S  y
? x' ?    ?
? y'?    ? 0
?? x ?
S  ?  y

(x’, y’)
? x ? r cos ?
? y ? r sin ?
y

x' ? x cos? ? y sin ?
?   ?    ?

? x' ?
y ??

? cos?
?

? sin ? ?? x ?
?                                                                     回
y' ? x sin ? ? y cos?
?   ? ? ?
y'        sin ?
??   ?
cos?     y
r
θ             (x, y)
?   ?    ?
??   ?
φ                                                                                                   
             ? 列ベクトルに左から行列を欷堡胄韦潜恧工长趣できる
O                                                                               x








平行移婴涡辛斜憩F
同次座耍1）

? 平行移婴摔膜い皮???

x' ? x ? tx



?   ? ? ?



t
? ? ? x ?

? 同次座耍homogeneous coordinates）を用いると，缀 Qをすべて行列のeで表Fできる

? 点 (x, y) を (x, y, 1) で表Fする
? x' ?
? x ?   ?   ?
y' ? y ? t y
? y'?
? y ?   ? y ?
?   ?   ?   ?   ?   ?
? 平行移
? x ' ?    ? 1   0
tx ? ? x ?                 ? x ?
?    ?    ?               ? ?   ?                 ?   ?
行列のeの形で表Fできない
? y ' ? ? ? 0   1
t y ? ? y ? ? T (tx , t y ) ? y ?


? 形式の`いは，缀QをまとめてQうHにきわめて不便
?    ?    ?               ? ?   ?                 ?   ?
?    ?    ?               ? ?   ?                 ?   ?
? 大?s小
? x ' ?    ? sx
0    0 ? ? x ?                  ? x ?
?    ?    ?                 ? ?   ?                  ?   ?
? y ' ? ? ? 0
sy       0 ? ? y ? ? S (sx , sy ) ? y ?
?    ?    ?                 ? ?   ?                  ?   ?
?    ?    ?                 ? ?   ?                  ?   ?







2
2016/9/5








同次座耍2）
2次元缀Q：R映

? 回

? x ' ?    ? cos?
? y ' ? ? ? sin ?

? sin ?
cos?

0 ? ? x ?             ? x ?
0 ? ? y ? ? R(? ) ? y ?

? R映（reflection）とは，直にvして称な位置に移婴工 操作
?    ?    ?                              ? ?   ?             ?   ?
? 1 ?    ?
0           0        1 ? ? 1 ?             ? 1 ?                                                    
                        y
?    ?    ?                              ? ?   ?             ?   ?

? 平行移樱大?s小，回は行列によるy一的な方法で表 される
? T(tx, ty)，S(sx, sy) ，および R(θ) は，行列を表すと同rにQ そのものも表している

ySにvするR映の例

x' ? ? x y' ? y


O                                   x









同次座摔摔瑜Q式：R映

? R映（R像，反）
演n}（2/3）

? 直 y=x にvするR映の同次座摔摔瑜
? x ' ?   ? c
0   0 ? ? x ?
Q式を示せ．
? y ' ? ? ? 0   d
0 ? ? y ?
?    ?   ?              ? ?   ?
?    ?   ?              ? ?   ?
?    ?   ?              ? ?   ?
? ヒント： 移忧搬幛硇韦挝恢瞄vSを考えてください．

c ? 1, d ? ?1
c ? ?1, d ? 1
c ? ?1, d ? ?1
：xSについて
：ySについて
：原点について










演n}（2/3）         解答例

? 直 y=x にvするR映の同次座摔摔瑜 Q式を示せ．

? x ' ?   ? 0   1   0 ? ? x ?
2次元缀Q：スキュ`

? スキュ`（skew）あるいはせん断（shearing）とは， L方形が平行四x形になるようなQ
y

xS方向へのスキュ`の例
x ' ? y
y ' ? x
? y ' ? ? ? 1   0   0 ? ? y ?
?    ?   ?              ? ?   ?
?    ?   ?              ? ?   ?

x' ? x ? ay y' ? y

O                                            x








3
2016/9/5








同次座摔摔瑜Q式：スキュ`
合成Q

? スキュ`（せん断）

? x ' ?   ? 1   a


0 ? ? x ?

? 合成Q（composite transformation）
? x ?
?   ?
? y ' ? ? ? b
1   0 ? ? y ?
? 点 p ? ? y ?  にして，A1,  A2, A3 のにQする
?    ?   ?              ? ?   ?
?    ?   ?              ? ?   ?
?    ?   ?              ? ?   ?
?   ?
?   ?
? Q後の点は p' ? A3 ( A2 ( A1 p)) ? ( A3 A2 A1 ) p ? Ap

b ? 0
a ? 0

：xS方向のスキュ`
：yS方向のスキュ`
ただし， A ? A3 A2 A1
? Qの合成は行列のeで表Fできる
? 行列のeの番に注意











合成Q（2）

? Q A1, A2, …, An のにQ行うQを A1, A2, …, An の 合成Qと呼び， An… A2 A1 とく
? 任意の合成Qを1つの行列で表せることこそが，同次座 を用いる利点である

? x ' ?                      ? x ?
?    ?                      ?   ?
? y ' ? ? An ? A2 A1 ? y ?
?    ?                      ?   ?
?    ?                      ?   ?
演n}（3/3）

? 合成Qを用いると，任意の点を中心とする θ 回 の缀Qを行列のeとして求めることができる．任 意の点 (x0, y0) を回中心とすると，同次座摔摔瑜 Q式で示せ．

? ヒント：
①点 (x0, y0) が原点になるよう平行移婴罚
②原点 θ 中心に回させ，
③原点が再び点 (x0, y0) になるよう平行移 すればよい











演n}（3/3）         解答例

? 合成Qを用いると，任意の点を中心とする θ 回の缀
同次座摔摔瑜Qの一般形

? アフィンQ（affine  transform）
Qを行列のeとして求めることができる．任意の点 (x0, y0) を
? x' ?   ? a   b
c ?? x ?
?   ?   ?
??   ?
回中心とすると，同次座摔摔瑜Q式で示せ．
? y'? ? ? d    e
f ?? y ?
?   ?   ?
??   ?

? x ' ?                                               ? x ?
? 1 ?   ? 0    0
1 ?? 1 ?
?    ? ? T ( x , y ) R(? )T (? x , ? y ) ? y ?
?    ?                                               ?   ?
?    ?                                               ?   ?
? 通常座讼丹扦
? x ' ?   ? a   b ? ? x ?   ? c ?
?    ? ? ?         ? ?   ? ? ?   ?
?    ?   ?         ? ?   ?   ?   ?
? 1   0
x0 ? ? cos?
? sin ?
0 ? ? 1   0
? x0 ? ? x ?
?                ? ?                              ? ?                   ? ?   ?
? a, b, d, e は大?s小，回，R映，スキュ`
? ? 0   1
y0 ? ? sin ?
cos?
0 ? ? 0   1
? y0 ? ? y ?
c, f は平行移婴虮恧
? 0   0    1 ? ?
0           0        1 ? ? 0   0      1  ? ? 1 ?
?                ? ?                              ? ?                   ? ?   ?

缀QのI理をy一的にQうことができる 合成Qが容易に行える







4
2016/9/5








缀Qと座Q

? 硇韦するQ操作と座溯SにするQ操作 は互いに逆向き（相a的）


Y'
Y
世界座摔茸爸米

? 描画する象を定xしている座讼丹蚴澜缱讼担world coordinate system, ワ`ルド座讼担─群簸

? 表示装置の上では画面（面）の上の座讼丹鲜澜缱摔趣 ovSにQまっている．これを装置座讼担device
Y                       P(x',y')
y                 y'                           P(x,y)
P(x',y')
y            P(x,y)
y'
coordinate system, デバイス座讼担─群簸郑

? 象を装置上に描画するためには，これらの座讼丹伍gの Qが必要．

b         0'            x'                                         X'
0          a           x                        X              0

x'       θ
x                       X
座讼丹纹叫幸                                      座讼丹位剀









正化装置座

? 同じデ`タを々な装置で描画するため，世界座摔 いったん实膜の (0, 1) に正化したものを作る

? 表示のHは，それをgHの装置に合致するようにさらにQ する
2次元ビュ`ポ`トQ

? 世界座摔ら装置座摔丐Q
? ウィンドウ（window）
? 世界座四冥嗽O定
? 象の一部を描く
? ビュ`ポ`ト（viewport）
? （正化）装置座摔嗽O定
世界座
正化装置座
装置座


装置座
? 画面の一部に描く
? ウィンドウとビュ`ポ`トの
? ビュ`ポ`トQ










ウィンドウとビュ`ポ`ト
ウィンドウとビュ`ポ`ト


世界座讼


Wyt


Vyt
装置座讼

世界座讼


Wyt


Vyt
装置座讼

Vyb

ビュ`ポ`ト
Vyb

ビュ`ポ`ト

Wyb

Wxl

ウィンドウ

Wxr


Vxl                                 Vxr

Wyb

Wxl

ウィンドウ

Wxr


Vxl                                 Vxr

}数のビュ`ポ`トをO定する ことが可能







5
2016/9/5








クリッピング

? クリッピング（clipping）：表示I域外の硇韦蓼郡悉饯我徊郡 除外する操作
? ウィンドウからはみ出る硇韦媳硎兢筏胜
? 硇韦晤I域以外の判定を高速に行う
? 一部のみウィンドウからはみ出すものを切り取る（clip：クリッ プ）操作
分のクリッピング
B

ウィンドウ                          D C                                               E

F A



? それぞれの分がクリッピングの象になるかどうかを 高速に判定する必要がある









Cohen-Sutheland法（1）

? 端点の位置に兢盲埔韵陇4ビットの2M数のラベルをつける
Cohen-Sutheland法（2）

①  I端点のコ`ドがともに0000の龊悉稀缚梢」
②  I端点のコ`ドのビットごとの理eを求めたY果が0000
でない龊悉稀覆豢梢」

ymax
1001         1000        1010
第1ビット
③  I端点のコ`ドの理eが0000の龊悉稀缚梢の可能性」
→ウィンドウの境界と分との交点をもとめる どちらか一方の端点だけで，
0001
0000
0010
コ`ドが1になっているビットを{べる
y ? ymax
1000
A
ウインドウ
1番目のビットが1： y = ymax の交点
ymin
2番目のビットが1： y = ymix
の交点
C                                        0010
D                    B
x ? x
0101         0100        0110
第2ビット
3番目のビットが1： x = xmax の交点
max

第4ビット
xmin
xmax

第3ビット
4番目のビットが1： x = xmix の交点
分ABの龊希1ビット目と3ビット目 が片方だけ1になっている








Cohen-Sutheland法（3）
中点分割法による分のクリッピング


A 1001

C
E 1000        1010    D

C: 1000
  D: 1010   
1000
不可

? 式を使わずに交点を求める

A
1010

0001
0000
0010    H                                                            M 1
F                                                         M
ウインドウ                                                             M 4
0101         0100        0110

B
M B
0001


Window







6
2016/9/5








中点分割法

①   分を中点によって2等分する
②   それぞれの分について，可，不可，可の可能性に分
③   可の可能性の分については，さらに2等分し同の判定
④   すべての2等分が可または不可になるまで反
A
1001
M

B
0001
1000
1001       A  1000

B        M
0001

AMもMBも不可
MBは不可だが，AMはま だ判定できない
→さらに分割




















































7
2016/9/6








今回のvx内容

コンピュ`タグラフィックス
第3回vxY料（3次元缀Qと野Q）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 6

? 3次元缀Q
?  3次元座讼
?  3次元缀Q：平行移樱大?s小，回，R映，スキュ`
?  3次元座讼丹摔ける合成Q

? 座Q
?  グラフィクスにおける各N座讼
?  3次元グラフィックスにおける座Q












【土】2次元座讼

? 2次元直交座讼
?  位置はx, y各Sにする位置を表す数のM (x, y) で表F
? O座讼
?  位置は原点からの距x r と基胜畏较颏らの角度 θ とのM (r, θ) で 表F
3次元座讼

? 3次元直交座讼
? O座讼
? 抑座讼
y

P (a,b)
b

d



Q (c,d)
y

P (r, θ)

r

θ


直交座讼丹 O座讼丹伍vS
?a ? r cos?
?
?b ? r sin ?
O             a               c             x             O                             x









3次元O座讼丹抑座讼

? O座讼                              ? 抑座讼
3次元直交座讼

? xS，ySにしてzSがどの向きにO定されているかによって， 右手系（right-handed coordinate system）と
左手系（left-handed coordinate system）
? 右手系→左手系：z'= -z
















1
2016/9/6








右手系と左手系
z                         画像の座讼      回方向          面の表Y 右
手                 y
系
【土】2次元硇

? 代表的な2次元硇韦摔希分やポリゴン（polygon, 多角形） などがある．
? すでに定xされている硇韦して平行移樱大?s小，回 などの湫尾僮鳏缀窝УQ（geometric transformation）と呼ぶ．
x            左下原点

z
左
手 系

x
y                                    左上原点
反r回り






r回り
点が反r回りが表 r回りがY





点がr回りが表 反r回りがY
7
y                                                                                               
点の座 B                         G                                                  ???? , ?? ? F     
                            ???? , ?? ?
???? , ?? ?
…

C                              E                         硇危ǖ悚瘟肖潜恧梗
A                                                                                   分A-B
D                              ポリゴンC-D-E-F-G
O                                                                                   x








gなモデリング

? 3次元硇韦涡巫搐蚴的に述することをモデリング
（modeling）と呼び，述される形状のデ`タを形状モデル
（geometric model）と呼ぶ
? 点とポリゴン（polygon，多角形）
【土】同次座耍1）

? 同次座耍homogeneous coordinates）を用いると，缀 Qをすべて行列のeで表Fできる

?  点 (x, y) を (x, y, 1) で表Fする
?  平行移
? x ' ?   ? 1   0
tx ? ? x ?                 ? x ?
?    ?   ?               ? ?   ?                 ?   ?
? y ' ? ? ? 0   1
t y ? ? y ? ? T (tx , t y ) ? y ?
?    ?   ?               ? ?   ?                 ?   ?
?    ?   ?               ? ?   ?                 ?   ?

?  大?s小
? x ' ?   ? sx
0    0 ? ? x ?                  ? x ?
?    ?   ?                 ? ?   ?                  ?   ?
? y ' ? ? ? 0
sy       0 ? ? y ? ? S (sx , sy ) ? y ?
?    ?   ?                 ? ?   ?                  ?   ?
?    ?   ?                 ? ?   ?                  ?   ?









【土】同次座耍2）
演n}（1/2）

?  回

? x ' ?   ? cos?
? y ' ? ? ? sin ?

? sin ?
cos?

0 ? ? x ?            ? x ?
0 ? ? y ? ? R(? ) ? y ?

? 下恧韦瑜Δxy座摔蛟点を中心に反r回りに30°回さ せたものをx’y’座讼丹趣工毪趣
?    ?   ?                             ? ?   ?            ?   ?
? 1 ?   ?
0           0       1 ? ? 1 ?            ? 1 ?
? x ' ?       ? x ?
?    ?   ?                             ? ?   ?            ?   ?

? 平行移樱大?s小，回は行列によるy一的な方法で表 される
? T(tx, ty)，S(sx, sy) ，および R(θ) は，行列を表すと同rにQ そのものも表している
1． xy座讼丹蔚悚x’y’座讼丹舜韦韦瑜 にQする行列Aを求めよ

2． x’y’座讼丹蔚悚xy座讼丹舜韦韦瑜 にQする行列Bをもとめよ
? y ' ? ? A ? y ?
?    ?       ?   ?
?    ?       ?   ?

? x ?       ? x ' ?
?   ?       ?    ?
? y ? ? B ? y ' ?
?   ?       ?    ?
?   ?       ?    ?
y’      y
x’
30° x









2
2016/9/6








演n}（1/2）   解答例

1． xy座讼丹蔚悚x’y’座讼丹舜韦韦瑜 にQする行列Aを求めよ


? x ' ?       ? x ?
?    ?       ?   ?
? y ' ? ? A ? y ?
?    ?       ?   ?
?    ?       ?   ?
同次座摔摔瑜3次元Q

? 2次元の龊悉韧
? 平行移樱大?s小，回などのQおよびそれらの合 成Qをg一の行列で表Fするため，同次座摔蛴盲い
? cos(?30?)
? sin(?30?)    0 ?
?   3/ 2     1 / 2     0 ?
?                                             ?    ?                              ?
? 通常座 (x, y, z) を (wx, wy, wz, w) (ただし w≠0) と表す
A ? R(?30?) ? ? sin(?30?)     cos(?30?)     0 ? ? ? ?1 / 2       3 / 2   0 ?
?       0                   0            1 ?    ?
0           0       1 ?
? 最初は易的に (x, y, z, 1) とする
?                              ?
?                              ?
2． x’y’座讼丹蔚悚xy座讼丹舜韦韦瑜 にQする行列Bをもとめよ

? x ?       ? x ' ?
?   ?       ?    ?
? y ? ? B ? y ' ?
?   ?       ?    ?
?   ?       ?    ?
? 座耍4次元ベクトル
? Q：4×4マトリックス
? 合成Q：Qマトリックスのe
? cos(30?)
? sin(30?)    0 ?
?   3/ 2
?1 / 2    0 ?
?                                         ?    ?                              ?
B ? R(30?) ? ? sin(30?)     cos(30?)     0 ? ? ?  1 / 2        3 / 2   0 ?
?      0                 0          1 ?    ?
0           0       1 ?
?                              ?
?                              ?









同次座吮憩Fによる平行移

? 平行移
硇危ǖ悖─颍x, y, z 各S方向にそれぞれ tx, ty, tz だけ 移婴丹护Qは，次式で表される
同次座吮憩Fによる大?s小

? 大s小
硇韦颍原点中心にx, y, z 各S方向にそれぞれ sx, sy, sz 倍に 大あるいはs小するQは，次式で表される


? x? ?   ? 1   0   0
tx ? ? x ?                     ? x ?
? x ' ?   ? sx
0     0    0 ? ? x ?                       ? x ?
? y ' ?   ? 0   1   0
?    ? ? ?
t  ? ? y ?                     ? y ?
y ? ?   ? ? T (t , t , t ) ?   ?
? y ' ?   ? 0    s
?    ? ? ?         y
0    0 ? ? y ?                       ? y ?
? ?   ? ? S (s , s , s ) ?   ?
? z ' ?   ? 0   0   1
tz ? ? z ?
x     y     z   ? z ?
? z ' ?   ? 0     0
sz       0 ? ? z ?
x      y      z   ? z ?
?    ?   ?                     ? ?   ?                     ?   ?
?    ?   ?                     ? ?   ?                     ?   ?
?    ?   ?                        ? ?   ?                       ?   ?
?    ?   ?                        ? ?   ?                       ?   ?












各座溯Sまわりの回
同次座吮憩Fによる回

? 回は回SによってQがなる

? x Sまわり

? x ' ?    ? 1       0           0        0 ? ? x ?              ? x ?
? y ' ?    ? 0   cos?
? sin ?
0 ? ? y ?              ? y ?
?    ? ? ?                                    ? ?   ? ? R (? ) ?   ?
? z ' ?    ? 0    sin ?
cos?
0 ? ? z ?
x          ? z ?


z                             z                            z
?    ?    ?                                    ? ?   ?              ?   ?
?    ?    ?                                    ? ?   ?              ?   ?
P'                                                                                       ? y Sまわり
? x ' ?    ? cos?
0    sin ?
0 ? ? x ?              ? x ?
P                                                                                              ? y 
' ?    ?
0        1       0       0 ? ? y ?              ? y ?
?    ? ? ?                                    ? ?   ? ? R       ?   ?
θ   P                                                                                               
      ? z ' ?    ? ? sin ?
0   cos?
0 ? ? z ?
y (? )   z ?
y     P'                       y                            y
? 1 ?    ?
0        0       0       1 ? ? 1 ?              ? 1 ?

θ    P'
?    ?    ?                                    ? ?   ?              ?   ?
P                                                         ? x ' ?    ? cos?
? sin ?
0    0 ? ? x ?              ? x ?
x                             x                            x
? z Sまわり
?    ?    ?                                    ? ?   ?              ?   ?
? y ' ?    ? sin ?
cos?
0   0 ? ? y ?              ? y ?
xS                        yS                       zS
?
? z ' ?    ?
? 1 ?    ?
? R  (? )  
0           0        1    0 ? ? z ?       z          ? z ?
0           0        0   1 ? ? 1 ?              ? 1 ?
?    ?    ?                                    ? ?   ?              ?   ?







3
2016/9/6








同次座吮憩FによるR映

? 3次元のR映は，直にvしてではなく，平面にvして称な 位置に移婴工氩僮鳏摔胜

? 例：xy 平面にvするR映
同次座吮憩Fによるスキュ`

? 行列のi 行 j 列の要素 ai,j ( i ≠ j ) が0でない龊希その要素は
「第 j Sの座の~が大きいほど，第 i S方向に
大きく歪む」というスキュ`のはたらきをもつ
?  ai,j は歪みの程度（~が大きいほうが歪みの量も大きい）


? x' ?


? 1   0    0


0 ?? x ?

? 例：y が大きいほどxS方向に大きく歪むスキュ`
?   ?    ?
??   ?
? y'?
? 0   1
0    0 ?? y ?
? x' ?
? 1   a
0   0 ?? x ?
? z' ? ? ? 0   0
? 1   0 ?? z ?
?   ?   ?        12
??   ?
?   ?    ?
?   ?    ?
??   ?
??   ?
? y'?
? ? 0     1
0   0 ?? y ?
? 1 ?
? 0   0
0    1 ?? 1 ?
? z' ?   ? 0
0     1   0 ?? z ?
?   ?   ?
?   ?   ?
??   ?
??   ?
? 1 ?   ? 0     0
0   1 ?? 1 ?









3次元アフィンQ

? アフィンQの特
? 直は直にQされる
? 直上の点gのLさの比は保存される
【土】合成Q

? 合成Q（composite transformation）
? x ?
?   ?
? 点 p ? ? y ?  にして，A1, A2, A3 のにQする
?   ?
?   ?
? x' ?   ? a    b
c    d ?? x ?
?  Q後の点は  p' ? A3 ( A2 ( A1 p)) ? ( A3 A2 A1 ) p ? Ap
?   ?   ?
??   ?
ただし， A ? A3 A2 A1
? y'?   ? e    f
g    h ?? y ?
? Qの合成は行列のeで表Fできる
? z' ? ? ? i
j    k    l ?? z ?

? 行列のeの番に注意
?   ?   ?
?   ?   ?
??   ?
??   ?
? 1 ?   ? 0    0
0    1 ?? 1 ?










【土】合成Q（2）

? Q A1, A2, …, An のにQ行うQを A1, A2, …, An の 合成Qと呼び， An… A2 A1 とく
? 任意の合成Qを1つの行列で表せることこそが，同次座 を用いる利点である

? x ' ?                      ? x ?
?    ?                     ?   ?
3次元座讼丹摔ける合成Q（1）

? 2次元座讼丹龊贤，3次元座讼丹摔いても，QA1,
A2, …, Anをに行う合成QAn… A2 A1を定xできる


? x ' ?                      ? x ?
? y ' ?                      ? y ?
?    ? ? A ? A A ?   ?
? y ' ? ? An ? A2 A1 ? y ?
? z ' ?      n
2    1 ? z ?
?    ?                     ?   ?
?    ?                     ?   ?
?    ?                      ?   ?
? 1 ?                      ? 1 ?










4
2016/9/6








3次元座讼丹摔ける合成Q（2）

? 点(x0, y0, z0) を中心とする大?s小


? x ' ?                                                                       ? x ?
? y ' ?                                                                  ? y ?
?    ? ? T ( x , y , z ) S (s , s , s )T (? x , ? y , ? z ) ?   ?
? z ' ?          0       0      0              x       y       z                   0            0   
        0    ? z ?
?    ?                                                                  ?   ?
?    ?                                                                  ?   ?
グラフィクスにおける各N座讼

?  モデル（モデリング）座讼
?  世界（ワ`ルド）座讼
?  点（カメラ）座讼
?  投影面座讼
?  装置（デバイス）座讼

（1）(x0, y0, z0) を原点に移す平行移
（2）大?s小Q
（3）原点を (x0, y0, z0)へ移す平行移









3次元グラフィックスにおける座Q
モデリングQ（modeling transformation）

? ビュ`イングパイプライン（viewing pipeline）

モデリング
Q                野Q             投影Q



ビュ`ポ`ト Q

? モデリング座讼丹らワ`ルド座讼丹丐缀Q，M  で表す
? モデルがA拥膜扦ればモデリング座讼丹怆A拥膜摔胜

モデリング座讼
モデリング 座

世界座             点座               投影面 座

装置座

z
世界（ワ`ルド）座讼

象をe に定x

象を配置          る位置に より浠

3次元から
2次元へ

デバイスの 画面に表示

M
モデリング座讼    M 2

3次元空gで定xされた象を，ある方向からて，                                                                            
                               y さらにこれを投影面（画面）に投影して2次元の硇韦趣罚                                        
                    M 3 表示装置の画面に表示する．                                                               
                    x









野Q（viewing transformation）

? ワ`ルド座讼丹らカメラ座讼丹丐缀Q，V で表す
? る位置によって硇韦伪憩Fがなる
投影Q（projection）

? カメラ座讼丹蛲队白讼丹Qする透投影や平行投影，
P で表す
? カメラ座讼
?  点を原点とし， 方向（注点） と回りの回 でQまる



点座讼
Ye
z

世界座讼
? 3次元から2次元に投影する
点

Ze

Xe
y x







5
2016/9/6








ビュ`ポ`トQ（viewport transformation）

? スクリ`ン上の硇韦颔钎％攻抓欹ど悉伪硎绢I域に切り出す，
U で表す
? 3次元では投影面，2次元ではワ`ルド座讼丹ら， デバイス座讼丹丐Q
演n}（2/2）

? ワ`ルド座讼丹らx方向に40，z方向に20平行移婴筏郡趣 ろにモデリング座讼丹あり，カメラ座讼丹希ワ`ルド座 系をxSまわりに30°Aけ，回後のzS方向に50平行移婴 
たところにあるとすると，以下の|を答えよ．

1．各座讼丹挝恢瞄vSを硎兢护
2．モデリングQを求めよ
3．野Qを求めよ

? ヒント： モデリングQ：モデリング座讼?ワ`ルド座讼 野Q：ワ`ルド座讼?カメラ座讼










【土】缀Qと座Q  大ヒント

? 硇韦するQ操作と座溯SにするQ操作 は互いに逆向き（相a的）
演n}（2/2）   解答例

1．各座讼丹挝恢瞄vSを硎兢护

Y'
Y                        P(x',y')

Y
P(x',y')
y                  y'                            P(x,y)
y            P(x,y)
y'


b         0'             x'                                           X'
0           a           x                         X               0
x'       θ
x                        X
座讼丹纹叫幸                                        座讼丹位剀









演n}（2/2）   解答例

2．モデリングQを求めよ
? モデリング座讼?ワ`ルド座讼 平行移
T (40, 0, 20)
3．野Qを求めよ
? ワ`ルド?カメラ 回と平行移
T (0, 0, -50) Rx (30?)
行列のeの番に注意
? 全体で
T(0, 0, -50) Rx(30?) T(40, 0, 20)





平行移 回









平行移








6
2016/9/6








今回のvx内容

コンピュ`タグラフィックス
第4回vxY料（投影Qと3次元クリッピング）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 6

? 投影Q
?  平行投影
?  透投影
?  投影の算手

? 3次元クリッピング
?  ビュ`ボリュ`ム
?  3次元クリッピング












投影Q

? 投影Q：3次元形状を2次元形状にQして表F
? 各点が投影平面（projection plane，平面）に投影される

? 平行投影（parallel projection）
?  o限h点からQy
?  C械Oの三面恧抢用
? 透投影（perspective projection）
?  空g内の1点からQy
?  h近法：hくのものほど小さく表F
?  点投影ともいう
平行投影?透投影











平行投影                             透投影










平行投影：正射投影

? 2つのSに垂直な投影平面



? x ' ?    ? 1   0   0   0 ? ? x ?
?    ?    ?                    ? ?   ?
平行投影：斜投影

x          x’
x’ = x y’ = y z’ = 0
? y ' ? ? ? 0   1   0   0 ? ? y ?
? z ' ?    ? 0   0   0   0 ? ? z ?
?    ?    ?                    ? ?   ?
?    ?    ?                    ? ?   ?

x        x’
正面をg寸で表し，
奥行きを45°のAき? Lさ1/2の割合にする





y                                                 z                                                 
                                     y                                               z y’           
                                                                                                    
                       y’

6







1
2016/9/6








透投影

? 3次元硇韦胃鞯悚ら点に向かってを引くと，投影面上 に投影と交点の集まりとして投影恧形成
y


投影面
透投影：1点透

? 消失点（vanishing point）
?  透投影はh近法ともよばれ，3次元空gにおける平行な直群が投 影砩悉扦1点に束する
? 1点透
?  2つのSに平行な平面への投影
消失点



点
z

点
x









透投影：2点透

? 1つのSに平行な平面への投影
透投影：3点透

? どのSとも平行でない投影面への投影


zw
平行
yv
d          xv
zv

ys
xs

消失点
xw                                                 yw










ビュ`ボリュ`ム

? ビュ`ボリュ`ム（view volume）：硇韦描かれる
平行投影のビュ`ボリュ`ム

? 平行投影のビュ`ボリュ`ムは直方体



ビュ`ボリュ`ム
ビュ`ボリュ`ム



後方クリッピング面
後方クリッピング面

前方クリッピング面

前方クリッピング面

投影面 点

透投影のビュ`ボリュ`ム：四角F体


方向

投影面








2
2016/9/6








投影の算手

① 点からhいほど奥行のを大きくするため， もとの座讼担ēメラ座讼担─蛴沂窒丹ら左 手系にQ
② ビュ`ボリュ`ムを正化ボリュ`ムにQ
平行投影の算法（1）

①  カメラ座讼丹蛴沂窒丹ら左手系にQ
?  xy平面にするR映QS(1, 1, -1)
②  ビュ`ボリュ`ムを正化ビュ`ボリュ`ムにQ
?  奥行 z は zmin  ≤ z ≤ zmax  を 0 ≤  z’ ≤ 1 の欷Q
?      2                 0                  0
?  xmax ? xmin  ?
③ 正化ビュ`ボリュ`ムを透投影
? x     ? x                                                     x
? x     ?
? x ' ?
?  max          min                                                                                 
     max         min  ? ? x ?
? y ' ?   ?        0
      2      
0           ?  ymax ? ymin  ? ? y ?
?    ? ? ?
?                                          ?       ? ?   ?
? z ' ?   ?
ymax
ymin
ymax
ymin  ? ? z ?
? 1 ?   ?        0                   0
      1      
?      zmin        ? ? 1 ?
?    ?   ?                                                                                    ? ?   
?
?                                           zmax ? zmin
zmax ? zmin  ?
?        0                   0                  0                    1         ?
?                                                                                    ?








平行投影の算法（2）

? ①～③をまとめた透投影Q
透投影の算法（1）

? 点から投影面（ウィンドウ）までの距x：d
?        2                   0                   0
? xmax   ? xmin   ?
? 投影面の大きさ，横（x）方向：2a，k（y）方向：2b
?        ?                                                                 ?        ?
? x ' ?
? xmax
xmin
xmax
xmin   ?
? x ?
点から前方/後方クリッピング面までの距x：z    /z
? y ' ?    ?        0
       2      
0           ?  ymax ? ymin   ?
? y ?                                                  ?
min
max
?    ?    ?                                                                                      ?  
              ?   ?
? ?                      ymax   ? ymin
ymax   ? ymin   ? S (1,1, ?1)
? z ' ?    ?                                                                                      ?
? z ?
? 1 ?    ?        0                   0
      1      
?      zmin           ?
? 1 ?
?    ?                                                                                              
               ?   ?
?                                            zmax   ? zmin
zmax   ? zmin   ?
?        0                   0                   0                    1         ?
?                                                                                      ?
?      2                  0                   0
?  xmax ? xmin   ?
?                                                                                      ?
? xmax   ? xmin
xmax  ? xmin   ? ? x ?   
?                             2      
?
?                      ymax   ? ymin
0           ?  ymax ? ymin   ?   y
max            min   ?
? z ?   
?                                                                                      ?
?        0                   0
     ?1     
?       zmin         
?   ?   
? ? 1 ?   
?                                            zmax   ? zmin
zmax   ? zmin   ?
?        0                   0                   0                    1         ?
?                                                                                      ?








透投影の算法（2）

①  カメラ座讼丹蛴沂窒丹ら左手系にQ
透投影の算法（3）

②  ビュ`ボリュ`ムを正化ビュ`ボリュ`ムにQ（Aき）
?  xy平面にするR映QS(1, 1, -1)
?  正化Q
?   d        d        1   ?
②  ビュ`ボリュ`ムを正化ビュ`ボリュ`ムにQ
?  後方クリッピング面が z = 1 に，z = 1 でのビュ`ボリュ`ムの欷
-1≤ x ≤1，-1≤ y ≤1の正方形になるよう大?s小
S ? az
?
,         ,        ?
max    bzmax     zmax  ?















3
2016/9/6








透投影の算法（4）

③  正化ボリュ`ムを透投影
?  四角F体を直方体に湫
透投影の算法（5）

③  正化ボリュ`ムを透投影（Aき）

? x ' ? X ' ? x
z?     ? zmin

とするとき
?       W '    z
 Z '
?    1   
   z?min     ? 1        1   
   z?min     1
min
zmax
?        Y '
y  ,  z ' ? W ' ? ? 1 ? z?
z ?
1 ? z?
?    ?             ?
z    1 ? z?
1 ? z?     z
? y ' ?       ?
?       min                       min  ?
min                   min

? 1   0        0              0      ?
??       W '     z
? X ' ?
?                                          ? ? x ?                 ? x ?
①～③をまとめた透投影Q
?     ?   ? 0   1        0              0
? ?   ?                 ?   ?
? Y ' ? ? ?
?       ? ? y ? ? P  ?
? y ?
? X ' ?                                                                      ? x ?

? Z ' ?
1
? 0   0
?   zmin

? ? z ?
? zmin ? ? z ?
?     ?                                                                      ?   ?
?     ?   ?
1 ? z?min
1 ? z?min  ? ?   ?                 ?   ?
? Y ' ? ? P ? z?
? S ?   d
,   d    ,  1
S ?1,1, ?1? ?   ?
?W ' ?
?                                          ? ? 1 ?                 ? 1 ?
? Z ' ?
min
? az       bz       z     ?
? z ?
? 0   0        1              0      ?
?     ?                    ?
max           max        max  ?                ?   ?
?W ' ?                                                                      ? 1 ?









透投影Q

? 透投影Q（射影Q）はアフィンQではない（W’  ≠ W ）
? 3 次元射影Qでは直は直にQされるが， 直上の距xの比は保存されない
? しかし，射影Qも4×4の行列で表F可能
?  缀Qと同じQいができる
点と画角

? 点と投影面の距xd を与える代わりに， 投影面の幅 S と画角 θ を使う龊悉ある

投影面


? X ' ?    ? a    b    c    d ? ? X ?


x'        a    b
?   ?    ?


c    d    x
??   ?
点                    ?       S
d
?   ?    ?
??   ?
? Y ' ?    ? e     f     g    h ? ? Y ?
?     ? ? ?                        ? ?    ?
? Z ' ?    ? i      j    k     l ? ? Z ?
?W ' ?    ? m    n    o    p ? ?W ?
? y'?
? z' ?
?   ?
1
? e     f
? ? i     j
?
0    0
g    h ?? y ?
k     l ?? z ?
??   ?
0    1    1
tan ? ? S / 2
S / 2
d ?       ?
?     ?    ?                        ? ?    ?
?   ?    ?
?   ?    ?
アフィンQ
??   ?
??   ?
2       d                  tan
2








3次元クリッピング

? 前方?後方クリッピング面について，その外部にある硇韦る いはその一部を除外する操作
? ビュ`ボリュ`ム（view volume）：硇韦描かれる
平行投影のビュ`ボリュ`ム

? 平行投影のビュ`ボリュ`ムは直方体


ビュ`ボリュ`ム


ビュ`ボリュ`ム

後方クリッピング面


後方クリッピング面
前方クリッピング面



投影面 点

前方クリッピング面

透投影のビュ`ボリュ`ム：四角F体


方向


投影面







4
2016/9/6








平行投影のクリッピング

? 2次元の龊悉韧に可/不可の判定と交点を求めるI 理を行う
? 前方?後方クリッピング面についても，让妞らQ察した恧 同に行うことができる
y
透投影のクリッピング

? 一般的には四角F体のビュ`ボリュ`ムとなる
? 4让妞よび前?後面でのクリッピングが必要

y
y

ビュ`ボリュ`ム
P'                     P'

ビュ`ボリュ`ム

点
z z                                           P                                                     
             前面
x                                         x                                     後面
x            P








【土】Cohen-Sutheland法（1）

? 端点の位置に兢盲埔韵陇4ビットの2M数のラベルをつける
【土】Cohen-Sutheland法（2）

①  I端点のコ`ドがともに0000の龊悉稀缚梢」
②  I端点のコ`ドのビットごとの理eを求めたY果が0000
でない龊悉稀覆豢梢」

ymax
1001        1000       1010
第1ビット
③  I端点のコ`ドの理eが0000の龊悉稀缚梢の可能性」
→ウィンドウの境界と分との交点をもとめる どちらか一方の端点だけで，
0001
0000
0010
コ`ドが1になっているビットを{べる
y ? ymax
1000
A
ウインドウ
1番目のビットが1： y = ymax の交点
ymin
2番目のビットが1： y = ymix
の交点
C                                     0010
D                  B
x ? x
0101        0100       0110
第2ビット
3番目のビットが1： x = xmax の交点
max

第4ビット
xmin
xmax

第3ビット
4番目のビットが1： x = xmix の交点
分ABの龊希1ビット目と3ビット目 が片方だけ1になっている








3次元クリッピングの6ビットコ`ド

? 境界面が6面となるため，I域をReコ`ドは6ビットになる



















5
2016/9/8








【土】3次元直交座讼

コンピュ`タグラフィックス
第5回vxY料（形状モデリング）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 8

? xS，ySにしてzSがどの向きにO定されているかによって， 右手系（right-handed coordinate system）と
左手系（left-handed coordinate system）
? 右手系→左手系：z'= -z












【土】同次座吮憩Fによる平行移

? 平行移
硇危ǖ悖─颍x, y, z 各S方向にそれぞれ tx, ty, tz だけ 移婴丹护Qは，次式で表される
【土】同次座吮憩Fによる大?s小

? 大s小
硇韦颍原点中心にx, y, z 各S方向にそれぞれ sx, sy, sz 倍に 大あるいはs小するQは，次式で表される


? x? ?   ? 1   0   0
tx ? ? x ?                     ? x ?
? x ' ?   ? sx
0     0    0 ? ? x ?                       ? x ?
? y ' ?   ? 0   1   0
?    ? ? ?
t  ? ? y ?                     ? y ?
y ? ?   ? ? T (t , t , t ) ?   ?
? y ' ?   ? 0    s
?    ? ? ?         y
0    0 ? ? y ?                       ? y ?
? ?   ? ? S (s , s , s ) ?   ?
? z ' ?   ? 0   0   1
tz ? ? z ?
x     y     z   ? z ?
? z ' ?   ? 0     0
sz       0 ? ? z ?
x      y      z   ? z ?
?    ?   ?                     ? ?   ?                     ?   ?
?    ?   ?                     ? ?   ?                     ?   ?
?    ?   ?                        ? ?   ?                       ?   ?
?    ?   ?                        ? ?   ?                       ?   ?












【土】同次座吮憩Fによる回
【土】同次座吮憩FによるR映

? x Sまわり

? x ' ?    ? 1       0           0        0 ? ? x ?              ? x ?

? 3次元のR映は，直にvしてではなく，平面にvして称な
? y ' ?    ? 0   cos?
? sin ?
0 ? ? y ?              ? y ?
?    ? ? ?                                    ? ?   ? ? R (? ) ?   ?
位置に移婴工氩僮鳏摔胜
? z ' ?    ? 0    sin ?
cos?
0 ? ? z ?
x          ? z ?
?    ?    ?                                    ? ?   ?              ?   ?
?    ?    ?                                    ? ?   ?              ?   ?

? 例：xy 平面にvするR映
? y Sまわり
? x ' ?    ? cos?
0    sin ?
0 ? ? x ?              ? x ?
? y ' ?    ?
0        1       0       0 ? ? y ?              ? y ?
?    ? ? ?                                    ? ?   ? ? R (? ) ?   ?
? x' ?
? 1   0    0
0 ?? x ?
? z ' ?    ? ? sin ?
0   cos?
0 ? ? z ?
y          ? z ?
?   ?    ?
??   ?
? 1 ?    ?
0        0       0       1 ? ? 1 ?              ? 1 ?
? y'?
? 0   1
0    0 ?? y ?
?    ?    ?                                    ? ?   ?              ?   ?
? z' ? ? ? 0   0
? 1   0 ?? z ?
? z Sまわり
? x ' ?    ? cos?
? sin ?
0    0 ? ? x ?              ? x ?
?   ?    ?
?   ?    ?
??   ?
??   ?
? y ' ?    ? sin ?
cos?
0   0 ? ? y ?              ? y ?
? 1 ?
? 0   0
0    1 ?? 1 ?
?    ? ? ?                                    ? ?   ? ? R (? ) ?   ?
? z ' ?    ?
? 1 ?    ?
0           0        1    0 ? ? z ?              ? z ?
0           0        0   1 ? ? 1 ?              ? 1 ?
?    ?    ?                                    ? ?   ?              ?   ?







1
2016/9/8








【土】同次座吮憩Fによるスキュ`

? 行列のi 行 j 列の要素 ai,j ( i ≠ j ) が0でない龊希その要素は
「第 j Sの座の~が大きいほど，第 i S方向に
大きく歪む」というスキュ`のはたらきをもつ
?  ai,j は歪みの程度（~が大きいほうが歪みの量も大きい）
【土】 3次元アフィンQ

? アフィンQの特
? 直は直にQされる
? 直上の点gのLさの比は保存される

? 例：y が大きいほどxS方向に大きく歪むスキュ`

? x' ?   ? a    b

c    d ?? x ?
?   ?   ?
??   ?

? x' ?

? 1   a12

0   0 ?? x ?
? y'?
? ? e    f
g    h ?? y ?
?   ?   ?
??   ?
? z' ?   ? i
j    k    l ?? z ?
? y'?    ? 0     1
0   0 ?? y ?
?   ?   ?
??   ?
? z' ? ? ? 0
0     1   0 ?? z ?
?   ?   ?
??   ?
?   ?   ?
?   ?   ?
??   ?
??   ?
? 1 ?   ? 0    0
0    1 ?? 1 ?
? 1 ?   ? 0
0     0   1 ?? 1 ?









【土】 3次元座讼丹摔ける合成Q（1）

? 2次元座讼丹龊贤，3次元座讼丹摔いても，QA1,
A2, …, Anをに行う合成QAn… A2 A1を定xできる
【土】 3次元座讼丹摔ける合成Q（2）

? 点(x0, y0, z0) を中心とする大?s小


? x ' ?                      ? x ?
? y ' ?                      ? y ?
?    ? ? A ? A A ?   ?
? x ' ?                                                                  ? x ?
? y ' ?                                                                       ? y ?
?    ? ? T ( x , y , z ) S (s , s , s )T (? x , ? y , ? z ) ?   ?
? z ' ?          0       0      0              x       y       z                   0            0   
        0    ? z ?
?    ?                                                                       ?   ?
? z ' ?      n
2    1 ? z ?
? 1 ?                                                                  ? 1 ?
? 1 ?                      ? 1 ?

（1）(x , y , z ) を原点に移す平行移
?    ?                      ?   ?
0      0     0
（2）大?s小Q
（3）原点を (x0, y0, z0)へ移す平行移









【土】 3次元グラフィックスにおける座Q
【土】投影Q

? ビュ`イングパイプライン（viewing pipeline）

モデリング
Q                野Q             投影Q



ビュ`ポ`ト Q

? 投影Q：3次元形状を2次元形状にQして表F
? 各点が投影平面（projection plane，平面）に投影される

? 平行投影（parallel projection）
モデリング 座
世界座             点座               投影面 座
装置座
?  o限h点からQy
?  C械Oの三面恧抢用
? 透投影（perspective projection）
象をe に定x
象を配置          る位置に より浠
3次元から
2次元へ
デバイスの 画面に表示
?  空g内の1点からQy
?  h近法：hくのものほど小さく表F
3次元空gで定xされた象を，ある方向からて， さらにこれを投影面（画面）に投影して2次元の硇韦趣罚 表示装置の画面に表示する．
?  点投影ともいう







2
2016/9/8








【土】投影の算手

①  点からhいほど奥行のを大きくするため，もとの座讼
（カメラ座讼担─蛴沂窒丹ら左手系にQ
②  ビュ`ボリュ`ムを正化ボリュ`ムにQ
③  正化ビュ`ボリュ`ムを透投影
【土】透投影Q

? 透投影Q（射影Q）はアフィンQではない（W’  ≠ W ）
? 3 次元射影Qでは直は直にQされるが， 直上の距xの比は保存されない
? しかし，射影Qも4×4の行列で表F可能
?  缀Qと同じQいができる


? X ' ?    ? a    b    c    d ? ? X ?
x'        a    b
?   ?    ?
c    d    x
??   ?
?   ?    ?
??   ?
? Y ' ?    ? e     f     g    h ? ? Y ?
?     ? ? ?                        ? ?    ?
? Z ' ?    ? i      j    k     l ? ? Z ?
?W ' ?    ? m    n    o    p ? ?W ?
? y'?
? z' ?
?   ?
1
? e     f
? ? i     j
?
0    0
g    h ?? y ?
k     l ?? z ?
??   ?
0    1    1
?     ?    ?                        ? ?    ?
?   ?    ?
?   ?    ?
アフィンQ
??   ?
??   ?








【土】 3次元クリッピング

? 前方?後方クリッピング面について，その外部にある硇韦る いはその一部を除外する操作
? ビュ`ボリュ`ム（view volume）：硇韦描かれる
【土】 3次元クリッピングの6ビットコ`ド

? 境界面が6面となるため，I域をReコ`ドは6ビットになる


ビュ`ボリュ`ム



後方クリッピング面

前方クリッピング面

投影面 点
透投影のビュ`ボリュ`ム：四角F体








今回のvx内容
形状モデルと形状モデリング

? 形状モデル
?  ワイヤフレ`ムモデル
?  サ`フェスモデル
?  ソリッドモデル
? ソリッドモデルの形状表F
?  境界表F
?  CSG表F
?  スイ`プ表F
? 境界表Fの局所湫





コンピュ`タに 取りzむ
g体







形状モデル
?  境界表Fのデ`タ造
?  オイラ`操作
g体の形をコンピュ`タが理解できる形式にQする

形状モデリング
形状モデル







3
2016/9/8








形状モデリング

? 3次元の物体形状を算Cの中で表F（定x）すること

? 形状分割モデル
?  形状の境界によって象形状を表F
?  数式表Fが可能
形状分割モデル

? 空g分割モデル
?  空gを分割して物体が存在するI域を指定
?  g，デ`タ量多い



ワイヤフレ`ムモデル
wireframe model



サ`フェスモデル
surface model



ソリッドモデル
solid model











ワイヤフレ`ムモデル

? だけをhすることで立体を表Fしたモデル
? 点の接AvSをgに表Fでき，I理が高速
? どこが立体の内部か不明で，立体同士の干h算やL消 去?L面消去ができない
ワイヤフレ`ムモデルの}点








A                           B                         C








サ`フェスモデル

? ワイヤフレ`ムモデルのデ`タに面の情螭蚋都婴筏骏猊钎
? L消去，L面消去や面の影表示が行える
? 物体内部の情螭虺证郡胜い郡幔体e算や物体同士の集 合演算はできない
ソリッドモデル

? サ`フェスモデルのデ`タに物体内外を区eする情螭虺证粒 中身のまった物体を表Fすることができるモデル
? 物体の和?e?差の集合演算や，体e算，物体同士の密 な干h算が可能















4
2016/9/8








ソリッドモデルの形状表F
境界表F

境界表F（B-reps）

CSG表F


U

スイ`プ表F

? 境界表FはB-reps（boundary representations）とも呼ばれ， 点（vertex），（edge），面（face）のデ`タとその接Av 
Sをグラフで保持して立体を表Fする
?  点，，面とその接AvS
?  面の法の向きで立体の内外

? 点，，面を基本要素（entity）と呼び，要素の接AvS を表す部分を位相（topology），点の座の部分を缀
（geometry）と呼ぶ
?  位相情螅夯イい谓泳AvS
?  缀吻螅捍螭さや位置座











境界表F




5つの面

8つの

5つの点
CSG表F

? CSG（Constructive Solid Geometry）はプリミティブ
（primitive）と呼ぶ基本立体を集合演算（set operation）によっ てMみ合わせることにより立体を表Fする
? 木造で表す（~：プリミティブ；中g点：集合演算）
? 同じ形を表すためのCSG表Fは1つとは限らない




位相：要素の接AvS 缀危喉点の座








CSG表F：ブリミティブ

? 直方体
? 多面体
? 抑
? 义F
? 角F
? 球
? くさび形
? ト`ラス
? 半空g など
CSG表F：集合演算

? 和（union）



? e（intersection）



? 差（difference）









5
2016/9/8








スイ`プ表F

? スイ`プ表F（sweep representation）は，立体の断面を表す
2次元硇韦蚨à幛椁欷寇道（trajectory）に沿って移婴筏郡 きのEとして形状を表Fする
境界表Fのデ`タ造

? 立体表Fの最もgなデ`タ造は，点の座摔让妞成 する点番号のKびを述
?  面の上にある点の数が固定できない
?  が明示的に示されない

















ウイングドエッジ造

? 配列の要素が固定Lとなるように，ウイングドエッジ（winged- edge）造を用いる
? 一本のに注目し，左右の面とのvSを述する
ウイングドエッジ造

? 点，，面のデ`タ デ`タを格{
Elccw             Ercw
Vn
Lr

E : 
Vp : _始点
Vn : K了点
F             E     Fr
Fl : 左趣蚊
Fr : 右趣蚊
Ll:左趣违氅`プ Lr:右趣违氅`プ
Ll
Elcw
Vp

Erccw
Elcw : 左趣r方向の Elccw : 左趣畏r方向の Ercw : 右趣r方向の Erccw : 右趣畏r方向の








オイラ`操作：二多体

? 立体境界（表面）上の任意の点が，つねに冶Pと等しい近傍 を持つものを二多体（two-manifold）と呼ぶ
オイラ`の公式とオイラ`操作

? 面に穴を含まない二多体では，オイラ`の公式が成り立つ
v ? e ? f ? 2

v：点の数；   e：の数；   f：面の数
? このvSを保持するように操作する湫尾僮鳏膝イラ`操作
（Euler operation）と呼ばれる














6
2016/9/8








オイラ`操作の例

? MEV（Make Edge Vertex）：点とを追加する
? KEV（Kill Edge Vertex）：点とを削除する
? MEF（Make Edge Face）：と面を追加する
? KEF（Kill Edge Face）：と面を削除する
? M（Make），K（Kill）?逆操作
オイラ`の公式

? 穴や突起，取っ手などのある龊希オイラ`の公式を次式に する
v ? e ? f ? r ? 2(s ? h)


v：点の数 e：の数 f：面の数（穴の内趣蚊妞馐える）

s：シェル（shell），物体のBY成分 h：穴（hole），物体を通する穴 r：リング（ring），面に含まれる穴
14-21+9-2=0=2(1-1)








したオイラ`操作

?  MVFS: Make Vertex Face Shell ? KVFS: Kill Vertex Face Shell
?  KEMR: Kill Edge Make Ring ? MEKR: Make Edge Kill Ring
?  KFMRH: Kill Face Make Ring Hole ? MFKRH: Make Face Kill Ring Hole
演n}（1/1）

? 以下の立方体の中を立方体が通した形状はオイラ` 式を氦郡筏皮い毪どうかを_Jせよ



















演n}（1/1）   解答例

? オイラ`式：
v ? e ? f ? r ? 2(s ? h)
?  v：点の数；   e：の数；   f：面の数；
r：面内のリングの数；  s：物体の数；   h：通した穴の数


16 ? 24 ? 10 ? 2 ? 2(1 ?1)

オイラ`式を氦郡










7
2016/9/9








今回のvx内容

コンピュ`タグラフィックス
第6回vxY料（曲?曲面のモデリング）

立命^大学 情罄砉ぱР   メディア情笱Э
李  亮  
2016. 9. 9

? 曲?曲面の表F形式
? v数形式
? v数形式
? パラメ`タ形式
? 2次曲
? パラメ`タ曲
? ファ`ガソン曲
? ベジエ曲
? Bスプライン曲
? 有理ベジエ曲
? NURBS曲










v数形式

? v数形式（explicit function form）：ひとつの座を他の 座のv数で表す
v数形式

? v数形式（implicit function form）：v数をに用いて曲? 曲面を定xする
? 平面曲：
y ? f ( x)
? 平面曲：
f ( x, y) ? 0
例（放物）
y ? x 2
例（半径rの遥
f ( x, y) ? x 2  ? y 2  ? r 2  ? 0
? 曲面：
z ? f ( x, y)
? 空g曲：
f (x, y, z) ? g(x, y, z) ? 0
例（回放物面） z ? a 2 ( x 2  ? y 2 )
? 曲面：
f ( x, y, z) ? 0
? 任意のx, yのMにして，曲面上の点は1点Qまる

? 地形などの高さを表Fするために使われる
? ハイトフィ`ルド（height field）
? ある点(x, y)における烁z
例（半径rの球面）  f ( x, y, z) ? x2  ? y 2  ? z 2  ? r 2  ? 0
? 3次元空g：3つの自由度がある；1つの式で1つの拘束
? 交点算にmしている；曲や曲面上の点の等g隔でのサン プリングに不m切









パラメ`タ形式

? パラメ`タ形式（parameter form, parametric form）： それぞれの座摔颔靴楗岍`タのv数として表Fする
? 平面曲：  x ? f (t ), y ? g (t)
2次曲

? 2次多式を用いたv数形式による代数曲
ax 2  ? by 2  ? c ? 2dxy ? 2ex ? 2 fy ? 0
? 3Nに分される
例（半径rの遥  x ? r cos t, y ? r sin t
0 ? t ? 2?
? 遥ellipse）
? 空g曲：
x ? f (t ), y ? g (t), z ? h(t )
? 放物（parabola）
? 曲面：
x ? f (u, v),  y ? g (u, v),  z ? h(u, v)
? 双曲（hyperbola）
例（半径rの球面）  x ? r cos u cos v, y ? r sin u cos v, z ? r sin v
? 平面上の回と平行移婴摔瑜市韦Qできる
0 ? u ? 2? ,
? ? / 2 ? v ? ? / 2
? （例）
x 2         y 2
? パラメトリック曲，パラメトリック曲面と呼ばれ
v数形式
?      ? 1 ? 0
a 2         b2
(a, b ? 0)
? 曲?曲面上の点列を求めるが容易；交点算はyしい
パラメ`タ形式
x ? a cos? ,
y ? b sin ?








1
2016/9/9








2次曲：义F曲

? 义F曲：すべての2次曲は义Fの断面として得られる
パラメトリック曲

? パラメトリック曲（parametric curve）：各座摔パラメ`タ t
のv数形式で C=F(t) として表F
? v数のNによって
? 多式曲（polynomial curve）：F が t の多式
? 有理式曲（rational curve）：F が t の有理式
? }数のv数で区分的に表F
? セグメント（segment）：各部分をなるv数で表F
? }合曲（composite curve）：いくつかのセグメントをつないで成
? v数のNによって
? 区分多式曲（piecewise polynomial curve）
? 区分有理式曲（piecewise rational curve）










区分的パラメトリック曲

? ファ`ガソン曲
? ベジエ曲
? Bスプライン曲
? 有理ベジエ曲
? NURBS（非一有理Bスプライン曲）
曲の性|にvする用Z

? 凸包性：曲が制御点が成する凸包の内部に存在する
? p少性：曲が制御点列の形状をなめらかにした形になる
? 局所性：1つの制御点を移婴筏郡趣，曲の中で湫韦工氩 分が限定される
? 直再F性：制御点を直上に配置すると，得られる曲が直 になる
? アフィン不湫裕呵にアフィンQを施したY果と，アフィン Qを施した制御点から得られる曲が一致する
? 2次曲の再F性：窑遥双曲を正_に表Fできる
? 射影不湫裕呵に射影Qを施したY果と，射影Qを施し た制御点から得られる曲が一致する










ファ`ガソン曲

? ファ`ガソン曲（Ferguson curve）：端点の位置ベクトルP0,
P1とその接ベクトルV0, V1をa完するものとして定xされた
P (t ) ? P H 3 (t) ? V H 3 (t) ? V H 3 (t ) ? P H 3 (t)   (0 ? t ? 1)
H 3 (t ) ? (2t ? 1)(1 ? t)2
ベジエ曲

? ベジエ曲（Bézier  curve）：制御点（control point）と呼ばれ る}数の点{Pi}に基づいて定xされる多式曲
P (t ) ? P B3 (t ) ? P B3 (t) ? P B3 (t) ? P B3 (t )   (0 ? t ? 1)
B3 (t ) ? (1 ? t)3
0
H 3 (t ) ? t(1 ? t)2
H 3 (t ) ? ?t 2 (1 ? t )
H 3 (t ) ? t 2 (3 ? 2t)
H 3 (t ) : 3次エルミ`ト(Hermite) v数
0
B3 (t ) ? 3t (1 ? t )2
B3 (t ) ? 3t 2 (1 ? t )
B3 (t ) ? t 3


B3 (t ) :
3次バ`ンスタイン基底v数
（Bernstein basis function）







2
2016/9/9








ベジエ曲：バ`ンスタイン基底v数

? n次のベジエ曲はn+1の制御点にn次のバ`ンスタイン基 底v数を混合比とした次式で表される
n
?  i    i     
ベジエ曲：ファ`ガソン曲とのvS

? 3次のベジエ曲を用いてファ`ガソン曲を表F可能
? 端点P0, P1をベジエ曲のP0, P3とする
P (t ) ?

i ?0
P Bn (t ) 

? 接ベクトルV0, V1を，式
ここで
?   ?   
?   ?   
P (t ) ? P B3 (t ) ? P B3 (t) ? P B3 (t) ? P B3 (t )   (0 ? t ? 1)

をパラメ`タtにvして微分した式とすると同じ曲が得られる
i                  ? i ?   
?      n!    t i (1 ? t )n ?i
i !(n ? i)!

V  ? d P (0) ? 3( P ? P )
0         dt                  1           0
d
V1  ?
P (1) ? 3( P3  ? P2 )
dt

各v数は各制御点の位置が、曲の形にどの程度影を与えるかをQめる








ベジエ曲の性|

? 次数 n = 1 の龊悉2つの制御点をYぶ直となる
? 制御点
? 曲は全部の制御点を通らない
? 端点は通^し，ここで制御点の作る多角形に接している
? 大域性がある（局所性がない）
? 制御点の位置を浃à毪惹全体の形が影
? 区g 0 ≤ t ≤ 1 内のベジエ曲は制御点で作られる
? 多角形（凸包）の中に存在する
? ベジエ曲にアフィンQを施したY果と、 制御点にアフィンQをして得られるベジ エ曲が同じ
? アウトラインフォントの生成に用いられる
ベジエ曲の性|：凸包

? 凸包（Convex Hull）：すべての制御点を含む最小の凸I域









ベジエ曲の性|：曲の分割

? ベジエ曲は任意のパラメ`タ t∈[0, 1] で，新たな2つのベジ エ曲に分割することができる
? この分割アルゴリズムは，ド?カステリュ（de Casteljau）のアル ゴリズムと呼ばれる
ベジエ曲の欠点

? ベジエ曲には大域性がある
? 1つの制御点の涓は曲全体に影する
? セグメントごとに定xし、セグメント（パッチ）の接A性は利用 者まかせ
? 区分的に曲を形成するHにBA性を容易に保^したい




B-spline曲









3
2016/9/9








Bスプライン曲

? Bスプライン曲（B-spline curve）：制御点{Pi}とノット列
（knot vector）{ti}によって定xされた曲
Bスプライン曲：Bスプライン基底v数

? ノット列 (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (?3, ?2, ? 1, 0, 1, 2, 3, 4, 5, 6)
の一3次Bスプライン基底v数
? }数の多式曲を接Aして1本の曲とする
? 各接A点でのパラメ`タのを指定するのがノット
n ? L ?1
?0
? 1    3
? 6
1              3                2
t ? (??, 0)
t ?[0,1)
N 3 (t ) ? N 3 (t ? 3)
N 3 (t ) ? N 3 (t ? 2)
P (t ) ?
? P N n (t ) 
?  (?3t  ? 12t  ? 12t ? 4)
N 3 (t ) ? ? 6
t ?[1, 2)
N 3 (t ) ? N 3 (t ? 1)
3                     1          3                 2                                                
                                                           2                      3
i ?0
(tn  ? t ? tn ? L )

n：次数
L：セグメント数
N n (t ) :
Bスプライン基底v数
（B-spline basis function）
? 6 (3t  ? 24t  ? 60t ? 44)
? 1 (4 ? t )3
? 6
?0
t ?[2, 3)
t ?[3, 4)
t ?[4, ?)

N 3 (t ) ? N 3 (t ? 1)
N 3 (t ) ? N 3 (t ? 2)








一?非一Bスプライン曲
非一 B-spline 曲

? 一Bスプライン曲：ノットが一定g隔
? （例） (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (?3, ?2, ?1, 0, 1, 2, 3, 4, 5, 6)

ノット列：

2

?0    0
2

0   1   2   3   4   4   4?
2                                                       2
? 非一Bスプライン曲：ノットが一定g隔でない
? （例） (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (0, 0, 0, 0, 1, 2, 3, 3, 3, 3)
? B-spline 曲を浃à毪摔
? 基底v数の次数を浃à
? ノットベクトルを浃à
? 制御点を移婴工
N0  (t ) 




N 2 (t ) 
N1  (t ) 




N 2 (t ) 
N2  (t ) 
N3  (t ) 




n=2
n=3
n = 2の龊悉
基底v数


?I端の制御点を通^する
?ＣＧでよく使われる



制御点

n=4








Bスプライン曲の性|

? n次のBスプライン曲の各セグメントは n+1 の制御点に よってQまる
? O同士のセグメントは  n の制御点を共有する
? 制御点とノット列を与えることにより全体の曲がQまる
? ノット列によりB-splinev数が定xされる
有理ベジエ曲

? 有理ベジエ曲（rational Bézier curve）：制御点{Pi}と各制 御点に辘工胫丐{wi}によって定xされる曲
? 重みを大きくすると辘工胫朴点に引き寄せられる
? 重みが同じ龊希通常のベジエ曲となる
n
? w P Bn (t ) 

P (t ) ? i ?0
i    i     i

(0 ? t ? 1)
Bn (t ) :
? Bスプライン曲は局所性を持つ
? Bスプライン曲もベジエ曲と同の凸包性を持つ
? アフィンQにする不湫预虺证
? 3次の龊希ノット列を(0,0,0,0,1,1,1,1)とすると，3次ベジエ曲 とまったく同じ曲となる
n
? w Bn (t ) 
i ?0
2次有理ベジエ曲は
2次曲（义F曲）を 正_に表Fできる
n次バ`ンスタイン基底v数
遥
0 ? wi  ? 1
放物： wi  ? 1
双曲： wi  ? 1







4
2016/9/9








NURBS曲

? NURBS曲（Non-Uniform Rational B-Spline curve）： 制御点{Pi}，各制御点に辘工胫丐{wi}，ノット列{ti}に よって定xする区分有理式曲
? 非一有理Bスプライン曲
? すべての重みを等しくするとBスプラインになる
n ? L ?1
NURBS曲の特

? 回，スケ`リング，平行移樱透投影などのQについ て不
? Bスプラインは透投影については不浃扦胜
? 制御点だけを透投影して，曲を生成すればよい
? 义F曲（例えば遥─蛘_に定xできる
?
P (t ) ?  i ?0
w P N n (t ) 

(t  ? t ? t
N n (t ) :
)    Bスプライン基底v数
? 2次NURBS曲のノット列を(0,0,0,1,1,1)とすると，2次有理ベジエ曲
になる
n ? L ?1
?
i ?0

wi Ni   (t ) 
n                    n ? L
? 制御点ごとにかい制御が可能になる

2次NURBS曲のノット列を(0,0,0,1,1,1)
とすると，2次有理ベジエ曲になる
2次曲を正_に表Fできる









B-splineとNURBS
パラメトリック曲の比^

? 曲の性|







重みのO定


ノット[0 0 0 0 1.66 3.33 5 5 5 5]






























5
2016/9/12








【土】形状分割モデル

コンピュ`タグラフィックス
第7回vxY料（曲?曲面のモデリング2）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 12




ワイヤフレ`ムモデル
wireframe model




サ`フェスモデル
surface model




ソリッドモデル
solid model











【土】ソリッドモデルの形状表F
【土】境界表F

境界表F（B-reps）
CSG表F


U
スイ`プ表F


5つの面

8つの

5つの点




位相：要素の接AvS 缀危喉点の座








【土】 CSG表F

? CSG（Constructive Solid Geometry）はプリミティブ
（primitive）と呼ぶ基本立体を集合演算（set operation）によっ てMみ合わせることにより立体を表Fする
? 木造で表す（~：プリミティブ；中g点：集合演算）
? 同じ形を表すためのCSG表Fは1つとは限らない
【土】スイ`プ表F

? スイ`プ表F（sweep representation）は，立体の断面を表す
2次元硇韦蚨à幛椁欷寇道（trajectory）に沿って移婴筏郡 きのEとして形状を表Fする















1
2016/9/12








【土】オイラ`の公式とオイラ`操作

? 面に穴を含まない二多体では，オイラ`の公式が成り立つ
v ? e ? f ? 2

v：点の数；   e：の数；   f：面の数
? このvSを保持するように操作する湫尾僮鳏膝イラ`操作
（Euler operation）と呼ばれる
【土】オイラ`操作の例

? MEV（Make Edge Vertex）：点とを追加する
? KEV（Kill Edge Vertex）：点とを削除する
? MEF（Make Edge Face）：と面を追加する
? KEF（Kill Edge Face）：と面を削除する
? M（Make），K（Kill）?逆操作















【土】オイラ`の公式

? 穴や突起，取っ手などのある龊希オイラ`の公式を次式に する
v ? e ? f ? r ? 2(s ? h)
【土】したオイラ`操作

?  MVFS: Make Vertex Face Shell ? KVFS: Kill Vertex Face Shell
?  KEMR: Kill Edge Make Ring ? MEKR: Make Edge Kill Ring
?  KFMRH: Kill Face Make Ring Hole ? MFKRH: Make Face Kill Ring Hole


v：点の数 e：の数 f：面の数（穴の内趣蚊妞馐える）

s：シェル（shell），物体のBY成分 h：穴（hole），物体を通する穴 r：リング（ring），面に含まれる穴
14-21+9-2=0=2(1-1)








【土】ファ`ガソン曲

? ファ`ガソン曲（Ferguson curve）：端点の位置ベクトルP0,
P1とその接ベクトルV0, V1をa完するものとして定xされた
P (t ) ? P H 3 (t ) ? V H 3 (t ) ? V H 3 (t ) ? P H 3 (t )   (0 ? t ? 1)
H 3 (t ) ? (2t ? 1)(1 ? t )2
【土】ベジエ曲

? ベジエ曲（Bézier curve）：制御点（control point）と呼ばれ る}数の点{Pi}に基づいて定xされる多式曲
P (t ) ? P B3 (t ) ? P B3 (t ) ? P B3 (t ) ? P B3 (t )   (0 ? t ? 1)
B3 (t ) ? (1 ? t )3
0
H 3 (t ) ? t (1 ? t )2
H 3 (t ) ? ?t 2 (1 ? t )
H 3 (t ) ? t 2 (3 ? 2t )
H 3 (t ) : 3次エルミ`ト(Hermite)  v数
0
B3 (t ) ? 3t (1 ? t )2
B3 (t ) ? 3t 2 (1 ? t )
B3 (t ) ? t 3


B3 (t ) :
3次バ`ンスタイン基底v数
（Bernstein basis function）







2
2016/9/12








【土】ベジエ曲の性|：凸包

? 凸包（Convex Hull）：すべての制御点を含む最小の凸I域
【土】 Bスプライン曲

? Bスプライン曲（B-spline curve）：制御点{Pi}とノット列
（knot vector）{ti}によって定xされた曲
?  }数の多式曲を接Aして1本の曲とする
?  各接A点でのパラメ`タのを指定するのがノット

P (t ) ?
n ? L?1
?
i ?0

Pi Ni  (t ) 
(tn  ? t ? tn? L )

n：次数
L：セグメント数
N n (t ) :
Bスプライン基底v数
（B-spline basis function）








【土】 Bスプライン曲：Bスプライン基底v数

? ノット列 (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (?3, ?2, ? 1, 0, 1, 2, 3, 4, 5, 6)
の一3次Bスプライン基底v数
【土】一?非一Bスプライン曲

? 一Bスプライン曲：ノットが一定g隔
?  （例）  (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (?3, ?2, ? 1, 0, 1, 2, 3, 4, 5, 6)
?0
? 1   3
? 6
? 1 (?3t 3 ? 12t 2 ? 12t ? 4)
N 3 (t ) ? ? 6
3                   1         3               2
?  (3t  ? 24t   ? 60t ? 44)
? 1 (4 ? t )3
? 6
?0
t ? (??, 0)
t ?[0,1)
t ?[1, 2)
t ?[2, 3)
t ?[3, 4)
t ?[4, ?)
N 3 (t ) ? N 3 (t ? 3) N 3 (t ) ? N 3 (t ? 2) N 3 (t ) ? N 3 (t ? 1)
2                    3
N 3 (t ) ? N 3 (t ? 1)
N 3 (t ) ? N 3 (t ? 2)
? 非一Bスプライン曲：ノットが一定g隔でない
?  （例）  (t0 , t1 , t2 , t3 , t4 , t5 , t6 , t7 , t8 , t9 ) ? (0, 0, 0, 0, 1, 2, 3, 3, 3, 3)
? B-spline 曲を浃à毪摔
?  基底v数の次数を浃à
?  ノットベクトルを浃à
?  制御点を移婴工













【土】有理ベジエ曲

? 有理ベジエ曲（rational Bézier curve）：制御点{Pi}と各制 御点に辘工胫丐{wi}によって定xされる曲
?  重みを大きくすると辘工胫朴点に引き寄せられる
?  重みが同じ龊希通常のベジエ曲となる
n
【土】 NURBS曲

? NURBS曲（Non-Uniform Rational B-Spline curve）： 制御点{Pi}，各制御点に辘工胫丐{wi}，ノット列{ti}に よって定xする区分有理式曲
?  非一有理Bスプライン曲
? w P Bn (t ) 
Bn (t ) :
?  すべての重みを等しくするとBスプラインになる
P (t ) ? i ?0
?

w Bn (t ) 
(0 ? t ? 1)
n次バ`ンスタイン基底v数
n? L ?1
?
P (t ) ?   i ?0
w P N n (t ) 

(t  ? t ? t
Ni  (t ) :
)     Bスプライン基底v数
i ?0

2次有理ベジエ曲は
2次曲（义F曲）を
n ? L ?1
?
i ?0
wi Ni  (t ) 
n                  n? L
正_に表Fできる
2次NURBS曲のノット列を(0,0,0,1,1,1)
遥
0 ? wi  ? 1
とすると，2次有理ベジエ曲になる
放物： wi  ? 1
双曲： wi  ? 1
2次曲を正_に表Fできる







3
2016/9/12








【土】 B-splineとNURBS









重みのO定


ノット[0 0 0 0 1.66 3.33 5 5 5 5]
今回のvx内容

? 2次曲面?ト`ラス面
? パラメトリック曲面
?  双3次ク`ンズ曲面，ベジエ曲面，Bスプライン曲面，有理ベジエ曲面，
NURBS曲面
? ポリゴン曲面の表F
?  ポリゴン曲面，分割曲面，平滑化I理，パラメ`タ化，度制御， 子透かし
? その他の形状表F法
?  ボクセル，八分木，フラクタル，メタボ`ル，パ`ティクル









2次曲面

? 2次多式によって表Fされる代数曲面
ax2 ? by 2 ? cz 2 ? d ? 2ezx ? 2 fzx ? 2gxy ? 2hx ? 2iy ? 2 jz ? 0
ト`ラス面

? ト`ラス面（torus）：2次曲面の；平面上の平行移婴然 によって，市韦Qできる
2
?   x2        y 2
?     z 2
?  颐妫ellipsoid）
?  1~双曲面（hyperboloid of one sheet）
?  2~双曲面（hyperboloid of two sheets）
?  义F面（elliptic cone）
?  曳盼锩妫elliptic paraboloid）
?  双曲放物面（hyperbolic paraboloid）
?  抑面（elliptic cylinder）
?  双曲柱面（hyperbolic cylinder）
?  放物面（parabolic cylinder）
?        ?      ? d ?  ?     ? 1 ? 0    (a, b, c, d ? 0)
?   a2        b2            ?     c2
?                       ?










パラメトリック曲面

? パラメトリック曲面（parametric surface）：各座摔パラメ`タ
u, v のv数形式で S=F(u, v) として表F
? v数のNによって
?  多式曲面（polynomial surface）：F  が u と v の多式
?  有理式曲面（rational surface）：F  が u と v の有理式
? uにvしてn次，vにvしてm次：n×m次曲面；n=mのr：双n次
? }数のv数で区分的に表F
?  パッチ（patch）：各部分をなるv数で表F
?  }合曲面（composite surface）：いくつかのパッチをつないで成
? 双3次ク`ンズ曲面：ファ`ガソン曲の
? ベジエ曲面，有理ベジエ曲面，Bスプライン曲面，NURBS曲 面：デンソルe曲面と呼ばれ
曲面の性|

? 凸包性：曲面が制御点の成する凸包の内部に存在する
? p少性：曲面が制御点列の形状をなめらかにした形にな る
? 局所性：1つの制御点を移婴筏郡趣，曲面の中で湫韦工氩 分が限定される
? 平面再F性：制御点を平面上に配置すると，得られる曲面が 平面になる
? アフィン不湫裕呵面にアフィンQを施したY果と，アフィン Qを施した制御点から得られる曲面が一致する
? 2次曲面の再F性：球面や颐妫双曲面などを正_に表F できる
? 射影不湫裕呵面に射影Qを施したY果と，射影Qを施 した制御点から得られる曲面が一致する








4
2016/9/12








双3次ク`ンズ曲面

? 双3次ク`ンズ曲面（bicubic coons surface）：四x形パッチ の四隅での4つのベクトル（位置ベクトルS，パラメ`タ方向の 接ベクトルSu, 
Sv，ねじれベクトルSuv），合16のベクトルに よって定xされる3次多式曲面
【土】ファ`ガソン曲

? ファ`ガソン曲（Ferguson curve）：端点の位置ベクトルP0,
P1とその接ベクトルV0, V1をa完するものとして定xされた
P (t ) ? P H 3 (t ) ? V H 3 (t ) ? V H 3 (t ) ? P H 3 (t )   (0 ? t ? 1)
H 3 (t ) ? (2t ? 1)(1 ? t )2
? S (0, 0)
S (0, 0)
S (0,1)
S (0,1) ? ? H 3 (v) ?                                                                               
                                      3
位置ベクトル
v                              v
?                                                                ?             ?
3                               2                                                       H i  (t ) : 
3次エルミ`ト(Hermite)  v数
S (0, 0)
S  (0, 0)
S  (0,1)
S  (0,1)  ? H 3 (v)  
H1 (t ) ? t (1 ? t )
S (u, v) ? [H 3 (u) H 3 (u) H 3 (u) H 3 (u)] ?   u                            uv                    
        uv                           u
? ?   1           ?
0                  1                   2                  3
? S (1, 0)
S  (1, 0)
S  (1,1)
S (1,1) ? ? H 3 (v) ?
H 3 (t ) ? ?t 2 (1 ? t )
u                            uv                            uv                           u
? ?    2           ?                                              2
S (1, 0)
S (1, 0)
S (1,1)
S (1,1)   ? H 3 (v) ?                                               3                2
?                    v                              v
? ?   3           ?
?
H3 (t ) ? t  (3 ? 2t )
u方向の接ベクトル
v方向の接ベクトル ねじれベクトル
（接ベクトルの浠を示す， 曲面のねじれ方を表す）
Su (u, v) ? ?u S (u, v)
S (u, v) ?  ?  S (u, v)
v                        ?v
? 2
Suv (u, v) ? ?u?v    (u, v)








ベジエ曲面

? ベジエ曲面（Bézier surface）：(n+1)×(m+1)の格子状にK べた制御点{Pij}によって定xされる曲面
?  制御点P00, Pn0, P0m, Pnmが四隅の位置を指定し，その他のものが曲面 の外形を定める
?  3次ベジエ曲面の四xは3次のベジエ曲となる

n      m
?? ij     i                 j
【土】ベジエ曲

? ベジエ曲（Bézier curve）：制御点（control point）と呼ばれ る}数の点{Pi}に基づいて定xされる多式曲
P (t ) ? P B3 (t ) ? P B3 (t ) ? P B3 (t ) ? P B3 (t )   (0 ? t ? 1)
B3 (t ) ? (1 ? t )3
B3 (t ) ? 3t (1 ? t )2
B3 (t ) ? 3t 2 (1 ? t )
S (u, v) ?
i ?0   j ?0
P Bn (u)Bm (v)
2
B3 (t ) ? t 3
n次とm次のバ`スタイン基底v数：
? ?                          n!
?  ?   

ui (1 ? u)n?i
i                    i                       i!(n   i)!
? ?                            ?

? m ?                            m!
Bm (v) ?        v j (1 ? v)m? j  ?


vi (1 ? v)m? j
B3 (t ) :
3次バ`ンスタイン基底v数
j                     j                         j !(m    j)!
（Bernstein basis function）
?  ?                              ?









有理ベジエ曲面

? 有理ベジエ曲面（rational Bézier surface）：制御点{Pij}と各 制御点に辘工胫丐{wij}によって定xする曲面
?  すべての重みを等しくすると通常のベジエ曲面になる

n     m
Bスプライン曲面

? Bスプライン曲面（B-spline surface）：制御点{Pij}とu方向，v
方向のノット列{ui}，{vi}によって定xされる曲面
?  n×m次のBスプライン曲面を成する各パッチは(n+1)×(m+1)の制 御点によって定められる
w P Bn (u) Bm (v)
?  L×Kのパッチからなるn×m次のBスプライン曲面は，パラメ`タの
??  ij    ij    i               j
 u  ≤ u ≤ u
, v   ≤ v ≤ v
で定xされる
S (u, v) ? i ?0  j ?0
(0 ? u, v ? 1)
n                   n+L      m
m+K
n     m
?? wij Bi  (u) B j  (v)
i ?0  j ?0
?  局所性を持つ

S (u, v) ?

n? L ?1 m? K ?1
?  ?


Pij Ni  (u) N j  (v)

Bn (u), Bm (v) :
i ?0
j ?0
i                 j
n次とm次のバ`スタイン基底v数
N n (u), N m (v) :
n次とm次のBスプライン基底v数








5
2016/9/12








【土】 Bスプライン曲

? Bスプライン曲（B-spline curve）：制御点{Pi}とノット列
（knot vector）{ti}によって定xされた曲
?  }数の多式曲を接Aして1本の曲とする
?  各接A点でのパラメ`タのを指定するのがノット
n ? L?1
NURBS曲面

? NURBS曲面（Non-Uniform Rational B-Spline surface）：制 御点{Pij}，各制御点に辘工胫丐{wij}，それにu方向とv方 向のノット列{ui}， 
{vj}によって定xする区分有理式曲面
?  非一有理Bスプライン曲面
?  すべての重みが等しいとBスプライン曲面になる
P (t ) ?
?
i ?0
Pi Ni  (t ) 
?  L×Kのパッチからなるn×m次のNURBS曲面は，パラメ`タ区g
un ≤ u ≤ un+L, vm ≤ v ≤ vm+K で定xされる
(tn  ? t ? tn? L )

n：次数

n ? L ?1 m? K ?1
?  ? wij Pij Ni  (u) N j  (v)
i ?0
j ?0
L：セグメント数
S (u, v) ?
n ? L ?1 m? K ?1
?  ?

wij Ni  (u) N j  (v)
N n (t ) :
Bスプライン基底v数
i ?0
j ?0
（B-spline basis function）
n (  ),
m ( ) :  n次とm次のバ`スタイン基底v数
Bi    u   B j    v








【土】 NURBS曲

? NURBS曲（Non-Uniform Rational B-Spline curve）： 制御点{Pi}，各制御点に辘工胫丐{wi}，ノット列{ti}に よって定xする区分有理式曲
?  非一有理Bスプライン曲
?  すべての重みを等しくするとBスプラインになる
n? L ?1
パラメトリック曲面の性|
?
P (t ) ?   i ?0
wi Pi Ni  (t ) 

(t  ? t ? t
Ni  (t ) :
)     Bスプライン基底v数
n ? L ?1
?
i ?0
wi Ni  (t ) 
n                  n? L

2次NURBS曲のノット列を(0,0,0,1,1,1)
とすると，2次有理ベジエ曲になる
2次曲を正_に表Fできる









ポリゴン曲面

? ポリゴン曲面（polygonal surface）：多数のかいポリゴンの 集合として表Fされた曲面
?  パラメトリック曲面を用いるHに}となる曲面パッチgのBA性を考 ]しなくてもいい
?  任意の多角形が使えるが，三角形を用いることが多い
?三角形は点さえQまれば必ず平面をなすことが保障できるから
?  このように多角形の集まりで表された形状デ`タはメッシュ（mesh）と呼 ばれる
分割曲面（1）

? 分割曲面（subdivision surface）：初期メッシュにgな分 割操作を再⒌膜诉m辘筏皮胜幛椁な曲面を得る手法
?  形状から分割をRり返すことで，全体がなめらかな曲面を得ることがで きる
?  初期メッシュの成はパラメトリック曲面の制御点に比べて自由であり，
?  最K的に得られる曲面が常になめらかとなる
?  }jな形状をgに作成することができる













6
2016/9/12








分割曲面（2）

? 分割ステップ（splitting）
?  点を追加し，メッシュの分割のしかたをQめる
? 平滑化ステップ（smoothing）
?  それぞれの点座摔蛐拚する
?  修正したい点とそれに接Aしている他の点の重み付け平均によっ て行われる．この重みをマスク（mask）やステンシル（stencil）と呼ぶ
カットマル?クラ`ク分割曲面

? カットマル?クラ`ク（Catmull-Clark）分割曲面
?  四角形を基本とし，分割ステップでは各面の中心と，各xの中心に点 を配置し，それらをYんで分割を行う
?  面上点の座摔悉饯蚊妞成する点の座摔纹骄で求められる
?  x上点の座摔限xのI端点とxの左右の面上点の平均で求められる
?  点の座摔享点のもとの座摔趣饯韦蓼铯辘蚊嫔系悚绒x上点の重み 付け平均によって求められる
?  点の数k：点に接Aするxの数














ル`プ分割曲面

? ル`プ（loop）分割曲面
?  三角形メッシュにする分割曲面
?  点の座摔享点の重み付け平均で求められる
平滑化I理

? 平滑化（smoothing）：ポリゴンに含まれるノイズを除去する
? 3
?16
?   ?

k ? 3

2 ?
? 1 ? 5 ? ? 3 ?  1 cos 2? ?  ?
k ? 3
? k ? 8
? 8    4
k  ?  ?
?   ??
?                      ?  ??














パラメ`タ化

? パラメ`タ化（parametrization）：ポリゴン曲面にパラメ`タ座 讼丹らの写像をBする
度制御

? 度（LOD: Level of Detail）制御：点からの距xに辘 て，た目に影を与えないようにポリゴン数をpらしてg 化（simplification）する手法

















7
2016/9/12








子透かし

? 子透かし（digital watermarking）：透かし（watermark）と呼 ばれる情螭颔签`タに埋めzみ，取り出す技g
?  不正コピ`やデ`タの改ざんなどの食
?  缀危点座耍─任幌啵点やの接AvS）に埋めzむ
?  缀韦丐温瘠徂zみ：点座摔颏铯氦に涓
?  位相情螭丐温瘠徂zみ：接AvSを涓する
ボクセル

? 2次元の画素（ピクセル，pixel）にして，3次元の小立方体を ボクセル（voxel）と呼ぶ
?  欠点：境界表FやCSGと比^すると，デ`タ量が膨大で精度が劣り，立 体の表示?移?回などに手gがかかる}がある
?  利点：デ`タ造や集合演算がg，自然物の不tの表Fにmす
?  各ボクセルに，その部分の透^率などのデ`タをもたせ，物体の内部 造まで表Fしたデ`タをボリュ`ムデ`タ（volume data）と呼ぶ















八分木

? 2次元の龊希核姆帜荆quadtree）
? 3次元の龊希喊朔帜荆octree）
? デ`タ量をs小することができる
? g一の物体上になるA婴蛑付à扦る
フラクタル

? 自己相似性（self-similarity）：s尺を浃à皮馊体と部分の形 状が相似のvSにある
? フラクタル（fractal）：自己相似性を持つ，つまり自分自身のs 小Qの集合で表せる硇
? コッホ曲，マンデルブロ集合，ジュリア集合
















メタボ`ル

? メタボ`ル（metaball）：ブロッブ（blob）や舛惹颏趣夂簸肖欤 舛确植激颏猡那颏渭合によって形状を定xする
?  舛趣魏亭一定となる面（等面）によって曲面を表す
?  や人体の表Fなどに使われることが多い
D(r ) ? D  exp(?ar 2 )
D0  : メタボ`ル中心における舛
a : 舛のp衰定数
r : メタボ`ル中心からの距x
パ`ティクル

? パ`ティクル（particle）：形が不定または明_な表面が存在し ない物体を，一定のtに兢盲粕成した多数の粒子（パ` ティクル）の集まりを用いて表Fする
? ポイントベ`ストモデリング（point-based modeling）：点の集 まりによって境界表面が明_な物体を表Fする











8
2016/9/12








今回のvx内容

コンピュ`タグラフィックス
第8回vxY料（L面消去1）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 12

? レンダリング
? L面消去
?  バックフェ`スカリング
?  L面消去法
?  先位アルゴリズム
?  スキャンライン法












レンダリング

? レンダリング（rendering）：コンピュ`タ内部に数デ`タとし て述されたシ`ンから2次元デジタル画像を生成するI理
レンダリングを成するI理

? 写g的な表Fを行うためのレンダリングは，透投影，L面 消去，シェ`ディング，そしてテクスチャマッピングなどの抗 付加I理から成される


















L面消去

? L消去（hidden-line removal）：手前の物体面によりえな い分，あるいは分の一部を消去して表示するI理
? L面消去（hidden-surface removal）：手前の物体面により えない面，あるいは面の一部を消去して表示するI理
バックフェ`スカリング

? バックフェ`スカリング（back-face culling）：背面除去とも呼 ばれ，点からたときに反方向を向いている不可の背 面の描画をスキップするI理
3                     2                    上： 0    1    2    3
下： 4    7    6    5
0                      1                              右： 1    5    6    2
7                                       左： 0    3    7    4
6                    前： 0    4    5    1
後： 3    2    6    7
4                      5

点からると  反r回り   ? 表面（える）   ? 描く r回り   ? 背面（えない）  ? 描かない







1
2016/9/12








表の面とYの面の判e法

? 表の面の法と点方向ベクトルとのなす角が角
? Yの面の法と点方向ベクトルとのなす角がg角
? 表の面とYの面は，面の法ベクトルと点方向ベクトルとの 内eを用いて判eすることができる
? 面の法ベクトルN， 点方向ベクトルV， 判e式Dfは
D f   ? V ? N  
Df >0のrは表の面，
Df <0のrはYの面，
法ベクトルの算出

? 面の法ベクトル（normal vector）は面を成する点Piを用 いて算出できる
?  凸ポリゴンの点が Pi ( i = 1, 2, …, m ) で定xされる
?  ポリゴンの任意の3点Pi, Pj, Pkの3次元座をそれぞれ (xi, yi, zi), (xj, yj, zj), (xk, yk, zk) 
(i<j<k)とし，点番号は反r回りに付けされてい るr，法ベクトルは，3点から成される2つのベクトルの外eによ り算出される
N ? ( Pi  ? Pj ) ? ( Pj  ? Pk )
nx   ? ( yi  ? y j )( z j  ? zk ) ? ( zi  ? z j )( y j  ? yk ) ny   ? ( zi  ? z j )( x j  ? xk ) ? 
( xi  ? x j )( z j  ? zk ) nz   ? ( xi  ? x j )( y j  ? yk ) ? ( yi  ? y j )( x j  ? xk )
Df =0のrはに平行
g位法ベクトル
N?  ?   N   ?           N          
N         nx  ? ny  ? nz








L面消去法

? L面消去アルゴリズムは，以下の3つに分することができる
? 物体空gアルゴリズム（object space algorithm）：3次元空g でL面消去の判定を直接行う方法
?  L消去を象としたものが多い
? 画像空gアルゴリズム（image space algorithm）：物体が投 影されるスクリ`ン（投影面）上のスキャンラインや画素g位 でL面消去のためのI理を行う方法
?  L面消去にするものが多い
?  スキャンライン法，Zバッファ法，レイトレ`シング法など
? 先位アルゴリズム（priority algorithm）：面の可性の 先位に基づいてL面消去を行う方法
?  物体空gアルゴリズムと画像空gアルゴリズムの中g的な方法
?  奥行きソ`ト法（ペインタアルゴリズム）など
先位アルゴリズム

? フレ`ムバッファ*にして，奥にある面を先に，手前にある面 を後に描くことでL面消去を行う
? 奥行きソ`ト法（depth-sort algorithm）：ペインタアルゴリズム
（painter’s algorithm，画家のアルゴリズム）とも呼ばれ，可
性の先位に兢盲泼妞颔僵`トし，可性の低いh方の面 からにフレ`ムバッファに重ね描きする方法






* フレ`ムバッファ：画像の画素の色を格{するメモリI域








奥行きソ`ト法

1.   描くすべての物体をポリゴンに分割
2.   各ポリゴンの重心を求める
奥行きソ`ト法の欠点

? 重心ソ`トではポリゴンの前後vSの判定が失・工毪长趣 ある
G ?  1 ( P ? P ? P  ? ? ? P    )
N     0          1          2
N ?1

3.   重心を方向に クイックソ`ト
4.   重心が点にして 奥にあるポリゴンから に重ねTりして 描いていく








2
2016/9/12








スキャンライン法

? スキャンライン法（scanline algorithm）：スキャンライン
（scanline，走司）に基づいてL面消去を行う方法
スキャンライン法（2）

すべてのポリゴンを投影する； スキャンラインを上から下へ番に移婴丹唬 それぞれのスキャンラインについて｛
走似矫妞去荪辚触螭趣谓徊罹分（スキャンセグメント）を求める 各スキャンセグメントの端点をx座摔涡・丹ろにソ`トする（xSソ`ト）； スキャンセグメントの端点によりサンプルスパンをQ定する； 
それぞれのサンプルスパンについて｛
奥行きの最も小さいスキャンセグメント（可セグメント）を求める； そのサンプルスパンに可セグメントの色をTる；
｝
｝










ポリゴンの走Q

? 走Q（scan conversion）：ポリゴンのxとスキャンラインと の交点を求め，ポリゴンに含まれる画素をQ定する
?  2つの交点gの画素がポリゴン内部の画素である
?  ポリゴンと交差するすべてのスキャンラインについてI理を行い，ポリゴ
ポリゴンの走Q：分法

? 分法（incremental method）：加算のみで交点を算出する
? スキャンラインをスクリ`ンの上から下に番に走摔筏皮い龊希ある スキャンラインとポリゴン1xとの交点を xi とすると，そのつぎのスキャン ラインと交点 xi+1  は次式より求められる
ン内部の画素をTりつぶすことでラスタ化（rasterize）できる
x    ? x ? ?x, ?x ? ?  1
(m : xのAき)
i ?1          i                                       m

あらかじめポリゴンの すべてのxを  y 座摔 vしてソ`トしておくこと により，高速I理する ことができる











可セグメントのQ定法

? サンプルスパン内に含まれるスキャンセグメントの数
?  1つしかない龊希嚎梢セグメント
?  }数存在する龊希亥单螗抓毳攻靴螭沃行膜扦饯欷兢欷违攻ャンセグメ ントの奥行きを算出し，最も奥行きの小さいスキャンセグメントを可セ グメントとする
?  スキャンセグメントが存在しない龊希罕尘吧がTられる
? 3次元空gでポリゴン同士が交差している龊悉摔希スキャン セグメントの交点でさらにサンプルスパンを分割しておく必要 がある
スキャンライン法の特

? 利点：
? 必要となるメモリはスキャンライン1本分のスキャンセグメン トI端点のx座だけでgむ
? 算量は比^的少ない
? 欠点：
? アルゴリズムのg装が}j
? 反射による映りzみや屈折を生じる物体を取りQうことはで きない











3
2016/9/13








【土】ポリゴン曲面

コンピュ`タグラフィックス
第9回vxY料（L面消去2）

立命^大学 情罄砉ぱР   メディア情笱Э
李  亮  
2016. 9. 13

? ポリゴン曲面（polygonal surface）：多数のかいポリゴンの 集合として表Fされた曲面
? パラメトリック曲面を用いるHに}となる曲面パッチgのBA性を考 ]しなくてもいい
? 任意の多角形が使えるが，三角形を用いることが多い
?三角形は点さえQまれば必ず平面をなすことが保障できるから
? このように多角形の集まりで表された形状デ`タはメッシュ（mesh）と呼 ばれる












【土】分割曲面（1）

? 分割曲面（subdivision surface）：初期メッシュにgな分 割操作を再⒌膜诉m辘筏皮胜幛椁な曲面を得る手法
? 形状から分割をRり返すことで，全体がなめらかな曲面を得ることがで きる
? 初期メッシュの成はパラメトリック曲面の制御点に比べて自由であり，
? 最K的に得られる曲面が常になめらかとなる
? }jな形状をgに作成することができる
【土】分割曲面（2）

? 分割ステップ（splitting）
? 点を追加し，メッシュの分割のしかたをQめる
? 平滑化ステップ（smoothing）
? それぞれの点座摔蛐拚する
? 修正したい点とそれに接Aしている他の点の重み付け平均によっ て行われる．この重みをマスク（mask）やステンシル（stencil）と呼ぶ














【土】度制御

? 度（LOD: Level of Detail）制御：点からの距xに辘 て，た目に影を与えないようにポリゴン数をpらしてg 化（simplification）する手法
【土】子透かし

? 子透かし（digital  watermarking）：透かし（watermark）と呼 ばれる情螭颔签`タに埋めzみ，取り出す技g
? 不正コピ`やデ`タの改ざんなどの食
? 缀危点座耍─任幌啵点やの接AvS）に埋めzむ
? 缀韦丐温瘠徂zみ：点座摔颏铯氦に涓
? 位相情螭丐温瘠徂zみ：接AvSを涓する














1
2016/9/13








【土】ボクセル

? 2次元の画素（ピクセル，pixel）にして，3次元の小立方体を ボクセル（voxel）と呼ぶ
? 欠点：境界表FやCSGと比^すると，デ`タ量が膨大で精度が劣り，立 体の表示?移?回などに手gがかかる}がある
? 利点：デ`タ造や集合演算がg，自然物の不tの表Fにmす
? 各ボクセルに，その部分の透^率などのデ`タをもたせ，物体の内部 造まで表Fしたデ`タをボリュ`ムデ`タ（volume data）と呼ぶ
【土】八分木

? 2次元の龊希核姆帜荆quadtree）
? 3次元の龊希喊朔帜荆octree）
? デ`タ量をs小することができる
? g一の物体上になるA婴蛑付à扦る














【土】フラクタル

? 自己相似性（self-similarity）：s尺を浃à皮馊体と部分の形 状が相似のvSにある
? フラクタル（fractal）：自己相似性を持つ，つまり自分自身のs 小Qの集合で表せる硇
? コッホ曲，マンデルブロ集合，ジュリア集合
【土】メタボ`ル

? メタボ`ル（metaball）：ブロッブ（blob）や舛惹颏趣夂簸肖欤 舛确植激颏猡那颏渭合によって形状を定xする
? 舛趣魏亭一定となる面（等面）によって曲面を表す
? や人体の表Fなどに使われることが多い
D(r) ? D exp(?ar 2 )
D0  : メタボ`ル中心における舛
a : 舛のp衰定数
r : メタボ`ル中心からの距x













【土】パ`ティクル

? パ`ティクル（particle）：形が不定または明_な表面が存在し ない物体を，一定のtに兢盲粕成した多数の粒子（パ` ティクル）の集まりを用いて表Fする
? ポイントベ`ストモデリング（point-based modeling）：点の集 まりによって境界表面が明_な物体を表Fする
【土】レンダリングを成するI理

? 写g的な表Fを行うためのレンダリングは，透投影，L面 消去，シェ`ディング，そしてテクスチャマッピングなどの抗 付加I理から成される














2
2016/9/13








【土】L面消去

? L消去（hidden-line removal）：手前の物体面によりえな い分，あるいは分の一部を消去して表示するI理
? L面消去（hidden-surface removal）：手前の物体面により えない面，あるいは面の一部を消去して表示するI理
【土】バックフェ`スカリング

? バックフェ`スカリング（back-face culling）：背面除去とも呼 ばれ，点からたときに反方向を向いている不可の背 面の描画をスキップするI理
3                    2                   上： 0    1    2    3
下： 4    7    6    5
0                     1                             右： 1    5    6    2
7                                     左： 0    3    7    4
6                   前： 0    4    5    1
後： 3    2    6    7
4                     5

点からると  反r回り  ? 表面（える）  ? 描く r回り  ? 背面（えない）  ? 描かない








【土】L面消去法

? L面消去アルゴリズムは，以下の3つに分することができる
? 物体空gアルゴリズム（object space algorithm）：3次元空g でL面消去の判定を直接行う方法
? L消去を象としたものが多い
? 画像空gアルゴリズム（image space algorithm）：物体が投 影されるスクリ`ン（投影面）上のスキャンラインや画素g位 でL面消去のためのI理を行う方法
? L面消去にするものが多い
? スキャンライン法，Zバッファ法，レイトレ`シング法など
? 先位アルゴリズム（priority algorithm）：面の可性の 先位に基づいてL面消去を行う方法
? 物体空gアルゴリズムと画像空gアルゴリズムの中g的な方法
? 奥行きソ`ト法（ペインタアルゴリズム）など
【土】先位アルゴリズム

? フレ`ムバッファ*にして，奥にある面を先に，手前にある面 を後に描くことでL面消去を行う
? 奥行きソ`ト法（depth-sort algorithm）：ペインタアルゴリズム
（painter’s algorithm，画家のアルゴリズム）とも呼ばれ，可
性の先位に兢盲泼妞颔僵`トし，可性の低いh方の面 からにフレ`ムバッファに重ね描きする方法






* フレ`ムバッファ：画像の画素の色を格{するメモリI域








【土】奥行きソ`ト法

1.   描くすべての物体をポリゴンに分割
2.   各ポリゴンの重心を求める
【土】スキャンライン法

? スキャンライン法（scanline algorithm）：スキャンライン
（scanline，走司）に基づいてL面消去を行う方法
G ? 1 ( P ? P ? P ? ? ? P    )
N    0           1           2
N ?1
すべてのポリゴンを投影する；
スキャンラインを上から下へ番に移婴丹唬 それぞれのスキャンラインについて｛
3.   重心を方向に
クイックソ`ト
4.   重心が点にして 奥にあるポリゴンから
走似矫妞去荪辚触螭趣谓徊罹分（スキャンセグメント）を求める
各スキャンセグメントの端点をx座摔涡・丹ろにソ`トする（xSソ`ト）； スキャンセグメントの端点によりサンプルスパンをQ定する； それぞれのサンプルスパンについて｛
奥行きの最も小さいスキャンセグメント（可セグメント）を求める； そのサンプルスパンに可セグメントの色をTる；
に重ねTりして                                                                                           
｝
描いていく                                                                                               
｝








3
2016/9/13








【土】スキャンライン法（2）                            【土】ポリゴンの走Q

? 走Q（scan  conversion）：ポリゴンのxとスキャンラインと の交点を求め，ポリゴンに含まれる画素をQ定する
? 2つの交点gの画素がポリゴン内部の画素である
? ポリゴンと交差するすべてのスキャンラインについてI理を行い，ポリゴ ン内部の画素をTりつぶすことでラスタ化（rasterize）できる
















今回のvx内容

? Zバッファ法
? Zバッファ法のアルゴリズム
? ポリゴンの奥行きの算
? Zバッファ法の特
? レイトレ`シング法
? レイトレ`シング法のアルゴリズム
? レイと物体との交差判定
? レイトレ`シング法の高速化
? レイトレ`ショング法の特
Zバッファ法

? Zバッファ法（Z-buffer algorithm）：画素ごとに奥行きの判定を 行いL面消去を行う方法
? 点の方向をzS方向とした龊希奥行き（depth）に相当し，デプスバッ ファ法（depth-buffer algorithm）とも呼ばれる
? フレ`ムバッファ（frame buffer）：画像の画素の色を格{する
? Zバッファ（Z buffer）：奥行き（z座）を画素ごとに格{する












Zバッファ法のアルゴリズム


フレ`ムバッファ F(i, j) のすべての画素を背景色で初期化する； Zバッファ Z(i, j) のすべての画素を最h点（o限大）で初期化する； すべてのポリゴンを任意の番で取り出し， 
それぞれのポリゴンについて｛
ポリゴンを透投影する； ポリゴンを走Qする； ポリゴン内部の各画素 (i, j) について｛
画素 (i, j) に辘工氲悚扦违荪辚触螭伟滦肖（z）を求める； ポリゴンのzと Z(i, j) を比^して；
z < Z(i, j) を氦郡工胜椁校
画素 (i, j) に辘工氲悚扦违荪辚触螭紊を F(i, j) に格{する；
Z(i, j) をポリゴンのzで更新する；
ポリゴンの奥行き（z）の算

? ポリゴンの法ベクトルを N(nx, ny, nz) ，ポリゴンのいずれの 点を Pi (xi, yi, zi) とすると，ポリゴンを含む平面上の点
P (x, y, z)は次式で表される
( P ? Pi )? N ? 0
各座顺煞证蚴工盲票恧工
nx x ? ny y ? nz z ? d ? 0
d は座讼丹卧点から平面に下ろした垂の符号付きLさ
d ? ? Pi ? N ? ?(nx xi  ? ny yi  ? nz zi )
よって
｝
｝                                                                                                   
                                                                 z        (nx x? ny y ? d )
｝                                                                                                   
                                                                          ?? 
z







4
2016/9/13








Zバッファ法の特

? アルゴリズムが比^的gで，バ`ドウェア化しやすいため，
GPU（Graphics  Processing Unit）で裼盲丹欷皮い
? 画素ごとに奥行きを算してL面消去が行われるため，平面 のポリゴンの他に，曲面にもm用できる
? 2つの面が互いに交差しているような龊悉扦猓面を分割する ことなく，そのままI理できる
レイトレ`ショング法

? レイトレ`ショング法（ray tracing algorithm，光追E法）： レイという1次元分上での交点の前後判定によりL面消去 を行う



ワ`ルド座讼丹摔いて 点からスクリ`ンの画 素に向かうレイとポリゴン との交点を算する












レイトレ`ショング法のアルゴリズム


スクリ`ンのすべての画素を番に取り出し， それぞれの画素について｛
点から画素に向かうレイをQ定する； レイとすべての物体との交差判定を行う；
レイと交差する物体が1つ以上存在するならば｛ すべての交点のなかで最も点に近いもの（可点）を求める； その画素に可点での物体の色をTる；
レイと球の交差判定

? 点をPE，レイのg位方向ベクトルを?，球の中心をS (xs, ys, zs) ， 球の半径をr，レイ上の点をP(x, y, z)とすると，点からの距x に相当するパラメ`タt 
を用いて点を通るレイの方程式は
P ? E? t ? P
? 球面上の点をP(x,  y, z)とすると，球の方程式は
P ? S  ? r
｝ そのはか（レイと交差する物体が存在しない）の龊希
その画素に背景色をTる；
｝
｝                                                                                                   
                                          レイと球の交点は上の
2つの式を同rに氦郡 点 P として与えられる









レイと球の交差判定（2）

? 球の式のIxを2\して，ベクトルの内eで表すと
( P ? S )?( P ? S ) ? r 2  ? 0
レイの式を代入して整理すると
at 2  ? 2bt ? c ? 0
レイとポリゴンとの交差判定（1）

? レイとポリゴンの交差判定は，まずポリゴンを含む平面とレイ との交点を求め，つぎにこの交点がポリゴン内部にあるかどう かを判定する
? ポリゴンを含む平面とレイとの交点のパラメ`タ t は
ただし
a ?  E?    ? 1,

b ? E? ?( P  ? S ),

c ?  P  ? S   ? r
t        ( PE  ? Pi )? N E? ? N  
E                                          E

? t にvする2次方程式の判e式 D ? b2  ? ac  が正のをとる 合，レイは球と交差する
? 交点Pでのg位法ベクトルは
N? ? P ? S
r
t > 0：点の前方に交点がある t < 0：点の後方に平面がある t = 0：点が平面上に存在する
E? ? N ? 0 : レイと平面が平行となる

t > 0の交点は可点の候aとする







5
2016/9/13








レイとポリゴンとの交差判定（2）

? 交点がポリゴン内部に存在するかどうかの判断には，3次元 空gで直接判断を行う方法と，2次元平面に射影して判定を 行う方法がある
? 算量や算`差の点から，2次元平面に射影した後判定を 行う方法がれている；点がポリゴン内部か外部かを判定す る方法は，大eすると，3つの方法がある
1.    点を端点とする半直とポリゴンのxとの交点の数をカウントする 方法
2.    点とポリゴンの各点とをYぶベクトルの外eの方向をチェックする 方法
3.    点とポリゴンの各点とをYぶベクトルgの角度を加算する方法
半直との交点数を用いた点の内外判定

? 点 P’ を端点とし任意の方向へ引いた半直とポリゴンのxと の交点の数を求める
? 交点数が奇数  ? 点 P’ はポリゴン内部に存在する
? 交点数が偶数  ? 点 P’ はポリゴン外部に存在する
? 算量は少ない；凹形状のポリゴンも取りQえる；ポリゴンの 点を通^する龊悉耍それを交点としてカウントするかどう かを判断するI理が必要











外eの方向を用いた点の内外判断

? 点 P’ とポリゴンの各点とをYぶベクトルを用いて外eを求 める
N 'i  ? ( P 'i ?1 ? P ') ? ( P 'i ? 2 ? P ')
? N’i がすべて同じ方向  ? 点 P’ はポリゴン内部に存在する
? N’i が1つでもなる方向  ? 点 P’ はポリゴン外部に存在する
? 凸形状のポリゴンに限定
角度の和を用いた内外判定

? 点 P’ とポリゴンのO接する各点とをYぶベクトルのなす角 の角度のt和を算する
? t和が 2π のとき  ? 点 P’ はポリゴン内部に存在する
? t和が 0 のとき  ? 点 P’ はポリゴン外部に存在する
? 凹形状のポリゴンも取りQえる；算量が多い















レイトレ`シング法の高速化

? バウンディングボリュ`ムを用いる方法：まずレイとバウンディ ングボリュ`ムとの交差判定を行い，それらが交差するときに 限り，バウンディングボリュ`ムに含まれる々のポリゴンに 
ついて交差判定を行う
? 空g分割法：あらかじめ3次元空gを立体格子状に分割し，分 割された各空gに存在する物体をして，レイが通^する ボクセルに存在する物体のみと交差判定を行う
? K列算による方法：}数のCPUを用いてI理する
レイトレ`シング法の特

? 交点算と可点のQ定がgであり，I理に必要なメモリ も少ないため，ソフトウェアのg装が比^的容易に行える
? 缀喂庋Г嘶づいている方法であるため，gなるL面消去だ けでなく，反射，透^，屈折など}jな光学F象をリアルに表 Fできる
? 画素ごとにI理を行うため，多くの算rgが必要となる











6
2016/9/13








今回のvx内容

コンピュ`タグラフィックス
第10回vxY料（マッピング）

立命^大学 情罄砉ぱР   メディア情笱Э
李  亮  
2016. 9. 13

? マッピング
? テクスチャマッピング
? テクスチャの生成
? テクスチャマッピングのI理方法
? アンチエイリアシング
? バンプマッピング
? h境マッピング
? ソリッドテクスチャリング












マッピング

? マッピング（mapping）：3次元物体面や曲面上にさまざまなパ タ`ンや模などをマッピング（写像）し，それらがちょうどはり 付けられたように表示を行う手法
? 2次元平面上で定xされる画像やv数を3次元物体面や曲面上にマッ ピングする手法
? テクスチャマッピング，バンプマッピング，h境マッピングなど
? 3次元空gで定xされるパタ`ンやv数を3次元物体にマッピングする 手法
? ソリッドテクスチャリング
テクスチャマッピング

? マッピングでは，はり付ける模や画像などをテクスチャ
（texture）あるいはテクスチャマップ（texture map）と呼び，
2次元テクスチャを3次元物体面や曲面などにはり付けて表示 することをテクスチャマッピング（texture mapping）という













テクスチャの生成

? テクスチャにはデジタルカメラなどで撮影されたg写画像やコ ンピュ`タによって生成された画像などが用いられる
? g写画像から照明の影を取り除いた被写体の散反射率， R面反射率を求める手法が_kされている
? コンピュ`タによって作成された々な画像をテクスチャとして 利用する．例えば，いくつかのパラメ`タを涓することにより， 々な似したテクスチャが得られる
テクスチャマッピングのI理方法

? テクスチャマッピングのI理は物体面上の各点と，テクスチャ 上の点をそれぞれ旮钉堡毪长趣摔瑜盲菩肖铯欷
? 投影による方法，O座Qを用いる方法，パラメ`タ座摔 用いる方法の3Nがある

? 投影による方法
? 透投影や平行投影の投影方向を逆にして，スクリ`ン上にテクスチャ を配置し，物体面にそれを投影する方法
? 投影テクスチャマッピングと呼ばれ，スポットライトの照明抗や影の表 示などにも用いられる










1
2016/9/13








テクスチャマッピングのI理方法（2）

? O座摔蛴盲い敕椒
? 物体の中心にO座讼丹卧点を置き，算点の3次元直交座摔O座 摔Qし，O座讼丹谓U度と度を表す角度を正化することにより テクスチャの座摔旮钉堡敕椒
? 2つのO付近でテクスチャがRsされてマッピングされる
テクスチャマッピングのI理方法（3）

? パラメ`タ座摔蛴盲い敕椒
? ベジエ曲などのパラメトリック曲上にテクスチャをマッピングするH によく用いられる
? テクスチャの色に基づいて反射率をRGB各成分挨嗽O定することで シェ`ディングを考]した画像が生成できる
? テクスチャの旮钉狈椒à摔瑜盲疲テクスチャが歪んでマッピングされ てしまう}がある















アンチエイリアシング

? テクスチャマッピングにおいては，解像度の高いテクスチャが マッピングされた面を表示するときのエイリアシング（aliasing） の}に注意が必要
アンチエイリアシング（2）

? テクスチャの平均色をマッピングする方法
? 画素の大きさを考]して，1画素のI域が旮钉堡椁欷毳匹スチャの I域を求め，そのI域内のテクスチャの色の平均をマッピングする方 法
? 前もってフィルタリングを行うため， プリフィルタリング（prefiltering）法とも呼ばれる















アンチエイリアシング（3）

? ス`パ`サンプリング法（supersampling）
? 画素内に}数のサンプリング点をOけ，そのサンプリング点に辘 るテクスチャの色を求め，サンプリング点でのテクスチャの色を平均ある いは加重平均してマッピングする色を求める
? 各サンプリング点での色を求めたあとでフィルタリングを行うため， ポストフィルタリング（postfiltering）法とも呼ばれる
アンチエイリアシング（4）

? ミップマップ（MIP map）法
? あらかじめ平均色を算し，ミップマップを作成しておくことにより，算 rgを短s
? もとのテクスチャのサイズを k?横とも1/2にs小したテ クスチャをRり返してミップ マップを作成し，テクスチャ マッピングのHには，表示 画素がもとの何画素分に 相当するかを求め，それに 
最も近い2つのs小レベル のテクスチャをマッピング に用いる

MIP map: Latin Multum In Parvo (much in a small space)







2
2016/9/13








バンプマッピング

? バンップマッピング（bump mapping）：模の代わりに凹凸を 物体面上にマッピングして表示する手法
? 物体の表面形状を浠させて凹凸を表Fするのではなく，テクスチャに 辘袱泼妞畏方向を浠させる
h境マッピング

? h境マッピング（environment mapping）：反射による周欷 映りzみをマッピングによりM似的に表示する手法
? 表示する物体を取り欷啶瑜Δ税刖钉未螭い球や 立方体を⑾氲膜嗽O置し，その内面に周欷苇h 境が映りzんだテクスチャをはり付け，物体面上 で反射したレイと⑾肭颏趣谓坏悚钎匹スチャの 色を求める















ソリッドテクスチャリング

? ソリッドテクスチャリング（solid texturing）：3次元空gでテクス チャを定x，々な形状に切り出して表示する方法
? 3次元テクスチャには3次元空gで定xされるv数を用いて，乱数など によりeらぎを与えて自然な模を作る






































3
2016/9/19








今回のvx内容

コンピュ`タグラフィックス
第11回vxY料（シェ`ディング）

立命^大学 情罄砉ぱР   メディア情笱Э
李  亮  
2016. 9. 19

? シェ`ディングとは
? シェ`ディングの基Aと概要
? h境光
? 散反射
? 平行光源?点光源?光源?面光源
? R面反射
? 完全R面反射?透^?屈折
? 散乱?p衰












シェ`ディングとは

? シェ`ディング（shading）：光の当たり具合によって獾が浠 する部分の明るさを算して表示すること
? 影付け（shadowing；シャドウイング）：ほかの物体や面によっ て光がさえぎられた影（shadow）のI域を求めて表示するI理
? シェ`ディングと影付けの2つのI理を施すことにより，写g的 な画像を生成することができる
放射量とy光量

? 光は磁波であり，そのエネルギ`は放射によって徊イ工
? 光のもつ物理的なエネルギ`は光学において放射量（radiant quantities）として取りQわれる

? 人gの眼は光の波Lに辘袱聘卸趣なる
? 照明工学においては，人gの眼というフィルタを通した光を y光量（luminous  quantities）として取りQう













光束

? 放射束（radiant flux，radiant power）：g位rgにある面を通 ^する放射エネルギ`量
? 光束（luminous flux）：放射束を眼の感度のフィルタ（感度） に通してた量
? g位は[lm]（Lumen；ル`メン）で表す
光度

? 点光源のある方向への光度（luminous intensity）は，光源位 置を点とするg位立体角内に放射される光束で表される
? g位は[cd]（Candela；カンデラ）
? 立体角（solid angle）：ある面e A を一点からたときの全周 にする冥り度合いを表し，立体角のy点に中心を置い た半径1のg位球への投影面e Ω で表される
? g位は[sr]（steradian；ステラジアン）；最大が4π
? 配光特性：光源の空gにする光度分布











1
2016/9/19








照度

? 照度（illuminance）：g位面eあたりに入射する光束
? g位は[lx]（Lux；ルクス）  1 lx = 1 lm/m2 = 1 cd・sr・mC2
? 半径 r の球の中心にすべての方向への光度が I の点光源を置いたと き，光源の放射する全光束は Φ = 4πI であり，球の内趣稳面e A =
4πr2 に入射するため，球面上のあらゆる点での照度 E は次式となる
光束k散度

? 光束k散度（luminous exitance）：g位面eからk散する光 束
? g位は[lm/m2]（ル`メン捌椒渐岍`トル）
? g位面eに入射する光束で与えられる照度と逆のvS
? 光束k散度 M と照度 E には，面の散反射率を ρd とすると，
E ? ? ?  4? I  ?  I
逆2\の法t
M = ρ  E のvSがある
A    4? r 2         r 2                                                                             
                                                                                                    
                                          d
? 面e A に垂直に光束が入射しているとき， 面上の照度は En = Φ /A となる，面のAけ 角度を θ とすると，面に入射する光束は Φcosθ となり，Aいた面上の照度 E θ は
E  ? ? cos? ? E  cos?
?                A           n
入射角余弦の法t









x度

? 反射面やk光面をある方向からたとき，x度（luminance） はその方向への光度をかけの面eで割ったで与えられ， 眼でたときに感じられる明るさに相当する
? g位は[cd/m2]（カンデラ捌椒渐岍`トル）
? 面の法から θ 方向の光度を dIθ ，かけの面eを dS’ とすると，θ 方 向のx度 Lθ は次式で求められる
シェ`ディングモデル

? どのような物理モデルを用いて，光源によって照られた物体を 表示するかをQ定するのがシェ`ディングモデルである
? 照明モデル（illumination model）やライティングモデル
（lighting model）とも呼ばれる
? 2Nに分できる
? 局所照明モデル（local illumination model）：直射光にvして物理的な
L      dI?
dI?
モデルに基づき照明算を行う
?  ?        ?
dS '    dS cos?
? どの方向からてもx度の等しい 表面を完全散面といい，次式を 氦郡

? 大域照明モデル（global illumination model）：g接光までを含めて物理 的なモデルに基づき照明算を行う
dI?  ? dIn cos?
ランバ`ドの余弦t
（Lamberts’s cosine law）








光源の分

? 缀窝У男巫搐涮匦预摔瑜攴诸
? 平行光（directional light）：太光のように光が同一方向にMむ
? 点光源（point light source）：1点から出た光が放射状に冥る
? 光源（linear light source）：Lさをもつ
? 面光源（area light source）：大きさをもつ
? 光と物|との相互作用により分
? 直射光（direct light）：光源から出た光がほかの物|との相互作用をせ ずに直接被照面に到_する光
? g接光（indirect light）：光源からkせられた光が，いったんほかの物| との相互作用を起こし，その光がほかの物体を照らす光となる
? 反射光（reflected light）：物体表面で反射，あるいは物体表面から入った光 が物|内で多重散乱したあとに表面に出てきた光（散反射，R面反射）
? 透^光（transmitted light）：物|との相互作用を起こした光として物|を通^
? 散乱光（scattered light）：微粒子によって散乱された光
散反射とR面反射

? 散反射（diffuse  reflection）：面をどの方向からてもx度 が一となり，反射光のさは光源の位置と，面の法に依 存する
? R面反射（specular  reflection）：正反射方向に近づくほどそ の反射光はくなり，面をる方向によってx度が浠する








2
2016/9/19








h境光

? h境光（ambient  light）：周欷らくる一な光
? h境光によって照らされたときの物体面の反射光のさ I は 次式によって求められる
I ? ka Ia    
ka ：h境光にする反射率
Ia ：h境光のさ

? 影のI域にもある程度の明るさを与えるために用いられる
? g接光を非常に大まかに近似した光として考えることができる
散反射：平行光

? 平行光で照射された龊悉散反射光のさ I は次式で 与えられる
I ? k I cos ? ? k I ( N? ? L? )
kd ：散反射率
Ii ：入射光のさ
? ：入射角 N?：面の法ベクトル L?：光の方向ベクトル
ka , kd











散反射：点光源

? 点光源の龊悉摔希光が光源から放射状に冥るため，光の 度は光源からの距xの2\に反比例する

I ?    d   qcos? ?    d    q  ( N? ? L? )
r 2                                 r 2
kd ：散反射率
散反射：光源

? w光灯のような光源による散反射光のさは，点光源が 直上にBA的にKんでいるものと考えて算できる
? 光源のLさ方向にする断面では，配光特性は光源を中 心とした倚韦趣胜
? 面上点 P での反射光のさは，次のe分式で表られる
Iq ：点光源の光度

d    q ?

L cos?
I ? k I
0
cos? dl r 2

gHにすべての光源は大 きさを持つが，物体からx れている小さな光源は点 光源となすことができる
Iq ：光源のg位Lさあたりの灯S方向の光度
L：光源のLさ
? ：点Pと光源上の点QをYぶ分と灯Sのなす角
? ：点Pと点QをYぶ分と法のなす角
r ：PQgの距x

平行光により照射された物体             点光源により照射された物体








散反射：面光源

? 面光源は，光源の中の微小面eを点光源として考え，光源面 すべてにわたってe分算することにより，反射光のさを 算できる
? 大きさ A を持つ光源を点 P を中心とした半径1のg位半球表 面に投影し，さらに半球底面に投影した面e A’ に比例し，反 射光のさは次式により与えられる
散反射：面光源（境界e分法）

? 立体角の正射面eの算量は多く，多角形光源にしては， 境界e分法により解析できる
? x度 La  の m 角形の光源の龊悉摔
k L   m
I ?   d     a  ? ? cos ?
2    l ?1
?l ：PQlとPQl ?1のなす角
I ? kd La A'
? ：三角形PQ Q
の法と
La ：光源のx度
l                                     l      l ?1
被照面の法とのなす角











3
2016/9/19








R面反射

? R面反射は物|表面での直接反射によって生じる
? 光gのあるプラスティックの表面や金属表面ではR面反射に よりハイライト（highlight）を生じる
? 入射角と等しい反射角となる正反射方向に光がく反射され る
? 光源の方向と物体面の向き，面の反射特性，点方向に依 存して，反射光の度が浠する
R面反射：フォンのモデル

? フォンのモデル（Phong illumination model）は点方向と正 反射方向のなす角 γ により，R面反射成分を cosnγ でp少さ せる方法であり，R面反射光のさ I 
は次式で与えられる
I ? W (? )I cosn ? ? W (? )I ( R? ?V? )n
Ii ：入射光のさ
? ：点方向と正反射方向のなす角
R? ：正反射方向ベクトル
V? ：点方向ベクトル W (? )：R面反射率 n：ハイライト特性制御パラメ`タ










完全R面反射?透^?屈折

? レイトレ`シング法では，物体が反射や透^?屈折を起こす 合にその物体とレイとの交点において，反射方向と透^?屈折 方向のレイをk生させ，散反射面に当たるかシ`ンの中に 
交差する物体がなくなるまで再⒌膜死Rり返す
正反射方向ベクトル

? Rのような完全R面反射特性を持つ物体表面に入射したレイ は，面の法にして入射角と等しい角度で反射する
? 正反射方向ベクトル
R ? V' ? 2 N? ? ?
V?
V? ? N?
? 2 N?
V? ：点方向へのg位ベクトル
N? ：面のg位法ベクトル
? 正反射方向のg位ベクトル

R? ?  R  ? V? ? N?  R R










屈折方向ベクトル

? スネルの法t（Snell’s law）を用いてレイの屈折する方向を 算でき，屈折方向ベクトル T は次式で表される
T ? k  ( N? ? V' ) ? N?
反射率と透^率

? なる屈折率をもつ媒|の境界での反射率 kr  は，フレネル 式（Fresnel equation）で表せる
1 ? sin 2 (? ? ? )    tan 2 (? ? ? ) ?
k  ?                1          2     ?           1          2
2   sin (? ? ? )    tan (? ? ? )
k f  ：屈折S数
?          1          2                              1          2    ?
kf < 1：法方向に近づく
kf > 1：法方向からxれる
kf = 1：レイは直Mする

スネルの法t
n1 sin ?1  ? n2 sin ?2
n1 , n2 ：媒|の屈折率
?1 , ?2 ：入射角と屈折角
?1 , ?2 ：入射角と屈折角

? 点趣亟欷光のさ
IV   ? kr Ir  ? kt It
kt ：通^率，kt   ? 1 ? kr
Ir ：反射方向からの光のさ
It ：屈折方向からの光のさ







4
2016/9/19








散乱?p衰

? 光が通^する媒体に散乱粒子が含まれる龊悉摔希散乱
（scattering）?p衰（attenuation）F象が生じる
? 空g中での光の1次散乱を考]すると，点 PE  に届く光の さは，つぎの2成分から成される①点 Q からの反射光成分
②光路 PEQ gの点 R において，光源からの光が点方向へ 散乱された光の成分



























































5
2016/9/19








今回のvx内容

コンピュ`タグラフィックス
第12回vxY料（影付け?大域照明モデル）

立命^大学 情罄砉ぱР  メディア情笱Э 李  亮
2016. 9. 19

? 影付け
?  本影と半影
?  平行光源?点光源による影
?  大きさをもつ光源による影
? 大域照明モデル
?  ラジオシティ法
?  フォトンマップ法












影付け

? 点光源による直射光を考えると，光源からkせられた光が物 体に当たると，その物体の背面には影が生じる．このような影 のI域を求めるI理を影付け（シャドウイング）と呼ぶ．
? シェ`ディングとはなるI理が必要となる
本影と半影

? 平行光や点光源によって生じる影は，影の境界とそうでな いI域がはっきりと分かれるが，面光源は境界がやける
? 本影（umbra）：光源からの光がまったく届かないI域
? 半影（penumbra）：光源からの光の一部が到_するI域

















平行光?点光源による影

? 平行光源や点光源による影は直射光がまったく当たらない本 影のみであるから，比^的gに影付けを行うことができる
? 主な方法には5つがある
1.     レイトレ`シング法
2.     スキャンラインg位の方法
3.     物体空gにおける2段A法
4.     シャドウポリゴン法
5.     Zバッファ法を用いた2段A法
レイトレ`ショング法による影付け

? 各画素に表示される面の位置と光源をYび，光源からの光を さえぎる物体（遮蔽物）があるかどうかを{べる方法
? 最もg；各画素ごとに判定を行うため，I理rgがかかる












1
2016/9/19








スキャンラインg位の方法による影付け

? スキャンラインg位のL面消去と影付けが同rに行われる
? 光源からたときの表の面の各xを，走嗣嫔悉I理しよう とする可面へ投影する
? 例：面 S1 の可区g P1-P3 において面 S2 による面 S1 上の 影の区g P1-P2 を算し，影付けを行う
物体空gにのける2段A法による影付け

? 光源と点からの2つの透恧蚯螭幔表示のHに影のI域 をマッピングする方法
?  第1段A：物体を光源からたときにLされるI域（影のI域）を物体空 gにおいて求める
?  第2段A：影のI域をマッピングし，影付けを行う
?  影のI域を求めることとL面消去が同一のアルゴリズムでgFできる
















シャドウポリゴン法による影付け

? 光源と遮蔽物によって生じる影の空gを考え，モデリングのH に物体デ`タに加えておく方法
?  影の空g：シャドウボリュ`ム（shadow volume）
?  シャドウボリュ`ムの成面：シャドウポリゴン（shadow polygon）
?  シャドウポリゴンと可面との交を求めて影のI域をQ定する
Zバッファ法を用いた2段A法

? 画像空gにおいてZバッファ法を用いて影となる画素をQ定す る方法
?  第1段A：光源位置を点としてZバッファ法を用いて光源から可面ま での距xを画素ごとに求める（シャドウマップを作成）
?  第2段A：点からたときの物体を表示するHには，各画素での可 点までの距xを比^し，距xがLければ遮蔽物が存在し影と判断
















大きさをもつ光源による影

? 近似的に求める方法
?  大きさをみつ光源の表面上にいくつかの点光源を配置し，点光源の集 合として光源を近似し，影を表示する；`差が大きい
? e分による求める方法
?  半影内の点の明るさはそこからた光源の可I域の大きさに依存し， e分によって求めることが可能
大域照明モデル

? 大域照明モデル：g接光も含めてより精密なモデルに基づい て照明算を行う
? 代表的な大域照明モデル
?  ラジオシティ法（radiosity method）
?  フォトンマップ法（photon map algorithm）














2
2016/9/19








ラジオシティ法

? シ`ンを成するポリゴンを小さなパッチに分割し，各パッチ のラジオシティ（放射k散度）を未知数としたラジオシティ方程 式（B立1次方程式）を解く
? ラジオシティ法による作成された画像の特
?  影が半影を伴う
?  直射光が届かない部分も相互反射によるg接光により照らされる
?  反射面の色がO接する面に影する（color-bleeding）
ラジオシティ法（2）

? パッチ同士のラジオシティ授受の割合を示すフォ`ムファクタ はパッチの形状や配置から算され，光源や点とはovS
? R面反射成分を考]すればI理が}jとなる
? R面反射や屈折を生じる透明な物体で生じる集光F象
（caustic）の表Fは困y  ? フォトンマップ法














フォトンマップ法

? 散反射面での光の相互反射と集光F象をy一的に取りQ うことのできる手法
? レイトレ`シング法の；散乱F象も取りQえる；パッチ分 割を行う必要がない
フォトンマップ法（2）

? 第1段A：フォ`トンマップのB
? 光源からフォトン（光子）を放出しして追Eし，R面反射成分を 持たない面にフォトンが到_したときには，フォトンマップにそ のフォトンの情螭虻清hする
?  コ`スティックフォトンマップ： フォトンが1回以上R面反射された 集合F象にvSする光の成分
?  グロ`バルフォトンマップ： すべての反射面や散乱粒子の相互 反射光を近似する情螭钎榨━去 が散乱面に到_したときに登h
?  ボリュ`ムフォトンマップ： 多重散乱光をQうため反射面や 散乱粒子により再度空gに放出 されたフォトンの情螭虻清h









フォトンマップ法（3）

? 第2段A：フォトンマップを利用した描画
? 分散レイトレ`シング（distributed ray tracing）を用いて，フォ トンマップの情螭虿握栅筏胜らレンダリングを行う
? 入射光を直射光，R面反射?透^によるg接光，散反射に よるg接光を3成分に分し，さらに面の反射成分も散反 射とR面反射の2つに分
? 直射光についてはレイトレ`ショング法を用いて求める
? 影付けには影フォトンを利用する











3
